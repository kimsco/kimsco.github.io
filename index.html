<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>1RM 계산기</title>
<style>
    body {
        background: black;
        color: white;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
        text-align: center;
        padding: 40px;
    }
    .container {
        max-width: 340px;
        margin: auto;
    }
    input, select, button {
        width: 100%;
        padding: 14px;
        margin: 10px 0;
        font-size: 18px;
        border-radius: 10px;
        border: none;
        box-sizing: border-box;
    }
    select {
        text-align: center;
        text-align-last: center;
    }
    button {
        font-size: 20px;
        background: white;
        color: black;
        font-weight: bold;
    }
    #result { margin-top: 20px; font-size: 22px; }
    table {
        width: 100%;
        margin-top: 25px;
        border-collapse: collapse;
        font-size: 17px;
    }
    table, th, td { border: 1px solid white; }
    th, td { padding: 10px; }
    .subtitle {
        font-size: 16px;
        margin-bottom: 12px;
    }
    .login-area button {
        background: #fff;
        color: #000;
        margin-top: 5px;
    }
</style>
</head>
<body>

<div class="container">
    <div class="subtitle">"대부분의 문제는 돈이 없어서, 그 외의 문제는 근육이 없어서 생긴다"</div>

    <h2>조현성을 위한 1RM 계산기</h2>

    <!-- 로그인 영역 -->
    <div class="login-area">
        <button onclick="login()">구글 로그인</button>
        <button onclick="logout()">로그아웃</button>
        <div id="userInfo"></div>
    </div>

    <!-- 무게 선택 -->
    <select id="weight">
        <option value="">무게 선택</option>
    </select>

    <!-- 반복수 선택 -->
    <select id="reps">
        <option value="">반복수 선택</option>
    </select>

    <!-- GO 버튼 -->
    <button onclick="calculate1RM()">GO</button>

    <!-- 저장버튼 -->
    <button onclick="saveRecord()">기록 저장</button>

    <div id="result"></div>
    <div id="tableArea"></div>
</div>

<!-- Firebase -->
<script type="module">
    // Firebase SDK 임포트
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-analytics.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged }
        from "https://www.gstatic.com/firebasejs/10.10.0/firebase-auth.js";
    import { getFirestore, doc, setDoc }
        from "https://www.gstatic.com/firebasejs/10.10.0/firebase-firestore.js";

    // Firebase 설정
    const firebaseConfig = {
        apiKey: "AIzaSyCXn174XsW6ndqaeUpVK6XAAf4MR0-q7_k",
        authDomain: "rmpj-7ca13.firebaseapp.com",
        projectId: "rmpj-7ca13",
        storageBucket: "rmpj-7ca13.firebasestorage.app",
        messagingSenderId: "983484366324",
        appId: "1:983484366324:web:5fd58faba825ee39decda1",
        measurementId: "G-MNGVMN6QCM"
    };

    // Firebase 초기화
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);

    // Auth, Firestore
    const auth = getAuth();
    const provider = new GoogleAuthProvider();
    const db = getFirestore();

    // 로그인
    function login() {
        signInWithPopup(auth, provider)
            .then(result => {
                console.log("로그인 성공:", result.user);
            })
            .catch(error => console.error(error));
    }

    // 로그아웃
    function logout() {
        signOut(auth).then(() => console.log("로그아웃"));
    }

    // 로그인 상태 표시
    onAuthStateChanged(auth, (user) => {
        const info = document.getElementById("userInfo");
        if (user) {
            info.innerHTML = `로그인: <b>${user.displayName}</b>`;
        } else {
            info.innerHTML = "로그인 안됨";
        }
    });

    // 무게 옵션 생성
    const weightSelect = document.getElementById("weight");
    for (let w = 0; w <= 250; w += 5) {
        let option = document.createElement("option");
        option.value = w;
        option.textContent = w + " kg";
        weightSelect.appendChild(option);
    }

    // 반복수 옵션 생성
    const repsSelect = document.getElementById("reps");
    for (let r = 1; r <= 10; r++) {
        let option = document.createElement("option");
        option.value = r;
        option.textContent = r + " 회";
        repsSelect.appendChild(option);
    }

    // 1RM 계산 함수
    window.calculate1RM = function () {
        const weight = parseFloat(weightSelect.value);
        const reps = parseInt(repsSelect.value);

        if (!weight || !reps) {
            document.getElementById("result").innerHTML = "무게와 반복수를 입력하세요.";
            return;
        }

        const oneRM = weight * (1 + reps * 0.0333);
        window.currentOneRM = oneRM; // 전역 저장
        window.currentWeight = weight;
        window.currentReps = reps;

        document.getElementById("result").innerHTML =
            `예상 1RM: <b>${oneRM.toFixed(1)} kg</b>`;

        let html = `<table><tr><th>RM</th><th>무게 (kg)</th></tr>`;

        for (let r = 1; r <= 10; r++) {
            let rmW = oneRM / (1 + (r - 1) * 0.0333);
            html += `<tr><td>${r}RM</td><td>${rmW.toFixed(1)} kg</td></tr>`;
        }

        html += `</table>`;
        document.getElementById("tableArea").innerHTML = html;
    };

    // 기록 저장
    window.saveRecord = async function () {
        const user = auth.currentUser;
        if (!user) return alert("로그인 먼저 해줘!");

        if (!window.currentOneRM) return alert("먼저 1RM 계산하고 저장해!");

        const record = {
            oneRM: window.currentOneRM,
            weight: window.currentWeight,
            reps: window.currentReps,
            timestamp: Date.now()
        };

        await setDoc(
            doc(db, "users", user.uid, "records", String(Date.now())),
            record
        );

        alert("저장 완료!");
    };
</script>

</body>
</html>
