<!DOCTYPE html>
<html lang="ko">
<head>
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#000000">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">

<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="MuscleFlow">
<link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>1RM</title>

<style>
/* ===============================
   ğŸ”¥ ì „ì²´ ë ˆì´ì•„ì›ƒ (í° ë¹„ìœ¨ ê³ ì •)
================================ */ 
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
 
   
    height: 100%;
    overflow: hidden;
}

body { 
    background: #111; 
   
    color: white;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
}

.app{
  width: 390px;
  height: 100vh;
  margin: 0 auto;
  background: black;

  padding: calc(var(--topBarH) + env(safe-area-inset-top)) 20px
           calc(var(--bottomTabH) + env(safe-area-inset-bottom));
  box-sizing: border-box;

  overflow-y: auto;
  overflow-x: hidden;
  -webkit-overflow-scrolling: touch;
}


.app::-webkit-scrollbar {
    display: none;             /* Chrome, Safari */
}

/* ===============================
   ê³µí†µ
================================ */
.container { max-width: 100%; margin: auto; }
.subtitle { font-size:16px; margin-bottom:20px; }
 
select, button, input {
    width:100%;
    padding:14px;
    margin:10px 0;
    font-size:18px;
    border-radius:10px;
    border:none;
    box-sizing: border-box;
}

button {
    background:white;
    color:black;
    font-weight:bold;
    cursor:pointer;
}

#result { margin-top:20px; font-size:22px; }
table input {
    width: 100%;
    box-sizing: border-box;
      padding: 8px;
}
table {
    width:100%;
    margin-top:15px;
    border-collapse: collapse;
    table-layout: fixed; /* ğŸ”¥ ì´ê±° ì¤‘ìš” */
}
table, td, th {
    border:1px solid white;
}
td, th {
    padding:8px;
    text-align:center;
}

/* ===============================
   ë¡œê·¸ì¸ ì˜ì—­
================================ */
  
.topBar{
  position: fixed;
  top: 0;
  left: 50%;
  transform: translate3d(-50%,0,0);

  width: 390px;
  max-width: 100%;
  height: var(--topBarH);

  padding: calc(env(safe-area-inset-top) + 8px) 16px 8px; /* ìœ„ìª½ë§Œ ì•ˆì „ì˜ì—­ */
  box-sizing: border-box;

  display:flex;
  justify-content: space-between;
  align-items: center;

  background: rgba(0,0,0,0.95);
  backdrop-filter: blur(10px);

  border-bottom: 1px solid rgba(255,255,255,0.04);
  z-index: 99998;
}


.topText{
  max-width: 300px;        /* ë„ˆë¬´ ê¸¸ê²Œ í¼ì§€ëŠ” ê±° ë°©ì§€ */
  font-size: 11px;         /* 0.66em ëŒ€ì‹  ê³ ì • ì¶”ì²œ */
  line-height: 1.35;
  opacity: 0.85;
}


#loginArea {
    display: flex;
    align-items: center;
    gap: 6px;
}

#loginArea button {
    padding: 6px 10px;
    font-size: 12px;
    border-radius: 6px;
    white-space: nowrap;
}

#userInfo {
    font-size: 11px;
    opacity: 0.8;
}

/* ===============================
   íƒ­
================================ */
.tab {
    display:flex;
    justify-content:center;
    gap:10px;
    margin-bottom:20px;
}
.tab button {
    background:#333;
    color:white;
    font-size:15px;
    padding:8px 12px;
}
.tab button.active {
    background:#FFD700;
    color:black;
}

.tabContent { display:none; }
.tabContent.active { display:block; }

/* ===============================
   3ëŒ€ ê¸°ë¡
================================ */


.rmInput {
    height:40px;
    text-align:center;
    background:#222;
    color:white;
    border-radius:8px;
}

/* ===============================
   ê¸°ë¡ í´ë”
================================ */
/* ===============================
   3ëŒ€ ì¢…ëª© ë²„íŠ¼ (ë¯¸ë‹ˆë©€ Cì•ˆ)
================================ */

/* ===============================
   âœ… ê¸°ë¡ íƒ­(ë²¤ì¹˜/ìŠ¤ì¿¼íŠ¸/ë°ë“œ/OHP) - iOS ë©”ëª¨ì¥ ëŠë‚Œ
================================ */
.recordFolders{
  display: flex;
  gap: 18px;
  justify-content: space-between;
  align-items: center;

  margin-top: 6px;
  padding: 2px 4px 6px;

  border-bottom: 1px solid rgba(255,255,255,0.10);
}

/* ë²„íŠ¼ ê¸°ë³¸ */
.folderBtn{
  flex: 1;
  background: transparent;
  border: none;

  padding: 8px 0 12px;
  margin: 0;

  color: rgba(255,255,255,0.55);
  font-size: 16px;
  font-weight: 650;
  letter-spacing: 0.2px;

  cursor: pointer;
  position: relative;
  -webkit-tap-highlight-color: transparent;
}

/* âœ… í™œì„±: ê¸€ì í°ìƒ‰ */
.folderBtn.active{
  color: #fff;
}

/* âœ… í™œì„± ë°‘ì¤„ (í°ìƒ‰) */
/* í™œì„± ë°‘ì¤„ */
.folderBtn.active::after{
  content: "";
  position: absolute;
  left: 0;
  bottom: -4px;
  width: 100%;
  height: 2px;
  background: #fff;          /* âœ… ë°‘ì¤„ë„ í°ìƒ‰ */
  border-radius: 2px;
}
.folderContent {
    display: none;
    margin-top: 10px;

    /* ë°°ê²½ */
    background: #222;
    border-radius: 8px;
    padding: 10px;

    /* ë†’ì´ */
    height: 450px;
    overflow: auto;

    /* ê¸€ì (iOS ë©”ëª¨ì¥ ëŠë‚Œ) */
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
    font-size: 16px;
    font-weight: 400;
    line-height: 1.9;
    letter-spacing: 0.2px;
    color: #E5E5E7;
}

.folderContent.active {
    display: block;
}

/* ===============================
   ê¸°ë¡ ì…ë ¥ í•œ ì¤„
================================ */
.recordFormRow {
    display:flex;
    gap:6px;
    align-items:center;
    margin-top:12px;
}


.recordFormRow input[type="number"] {
    height:40px;
    border-radius:8px;
    background:#222;
    color:white;
}

/* ===============================
   ë‹¬ë ¥
================================ */
.calendar .header {
    display: grid;
    grid-template-columns: 48px 1fr 40px;
    align-items: center;
    margin-bottom: 14px;
}
   .month-title {
    font-size: 16px;
    font-weight: 600;
    color: #eee;
    white-space: nowrap;   /* ğŸ”¥ ì¤„ë°”ê¿ˆ ë°©ì§€ */
    text-align: center;
}
 .month-btn {
    background: transparent;
    border: none;
    color: #8b0000; /* ì–´ë‘ìš´ ë¹¨ê°• */
    font-size: 18px;
    padding: 8px 10px;
    cursor: pointer;
    opacity: 0.7;
}

.month-btn:active {
    opacity: 1;
    transform: scale(0.95);
}  
/* ===== ìš”ì¼ ===== */
.weekdays {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    margin-bottom: 8px;
}

.weekdays div {
    text-align: center;
    font-size: 12px;
    color: #aaa;
    letter-spacing: 0.5px;
    padding-bottom: 6px;
}

/* ì¼ìš”ì¼ ë¹¨ê°„ í¬ì¸íŠ¸ */
.weekdays div:first-child { color: #8b0000; }

   /* ===== ë‚ ì§œ ê·¸ë¦¬ë“œ ===== */
.days {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 10px;
}

/* ë‚ ì§œ ì…€ */
/* ë‚ ì§œ ì…€ */
.days div {
  aspect-ratio: 1 / 1;
  background: #1a1a1a;
  border-radius: 12px;

  display: flex;
  align-items: center;
  justify-content: center;

  font-size: 15px;
  font-weight: 500;
  color: #eee;

  cursor: pointer;
  transition: all 0.18s ease;
}

/* hover (PC) */
.days div:hover {
  background: #2a2a2a;
  transform: translateY(-1px);
}

/* ì˜¤ëŠ˜ ë‚ ì§œ */
.days div.today {
  border: 1px solid #FFD700;
  color: #FFD700;
}

/* ìš´ë™í•œ ë‚  */
.days div.done {
  background: linear-gradient(135deg, #8b0000, #400000);
  color: white;
  font-weight: 600;
}



/* ì›” ì‹œì‘ ì „ ì§„ì§œ ë¹ˆì¹¸ë§Œ */
.days div.empty {
  background: transparent;
  cursor: default;
}





/* ===============================
   íŒì—…
================================ */
.popup {
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.7);
    display:flex;
    justify-content:center;
    align-items:center;
    z-index:9999;
}
.popup.hidden { display:none; }
.popup-box {
    background:#111;
    padding:20px;
    border-radius:12px;
    width:80%;
}
.muscles {
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:10px;
    margin:15px 0;
}
.muscles button.active {
    background:#8b0000;
    color:white;
}
.dateDisplay {
    width: 80px;
    height: 40px;
    background: #222;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    line-height: 1.2;
    color: #FFD700;
}

.dateYear {
    font-size: 11px;
    opacity: 0.85;
}

.dateMD {
    font-size: 13px;
    font-weight: bold;
}
.tabContent {
  display: none;
}

.tabContent.active {
  display: block;
}
.loginBtn {
  background: #1c1c1c;
  color: #ddd;

  border: 1px solid #333;
  border-radius: 10px;

  padding: 6px 12px;
  font-size: 12px;
  font-weight: 500;

  cursor: pointer;
  transition: all 0.15s ease;
}

.loginBtn:hover {
  background: #222;
  border-color: #444;
}

.loginBtn:active {
  background: #111;
}
   .loginBtn.loggedIn {
  background: none;
  border: none;
  color: #aaa;
  padding: 0;
}
.days div.done:hover { background: linear-gradient(135deg, #8b0000, #400000) !important; transform: translateY(-1px); }

/* ğŸ”’ ëª¨ë°”ì¼ long press í…ìŠ¤íŠ¸ ì„ íƒ ë°©ì§€ */
.days div,
.popup,
.popup * {
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;

  -webkit-touch-callout: none; /* iOS ë³µì‚¬ ë©”ë‰´ ì°¨ë‹¨ */
}

.part-btn {
  background: #111;
  color: #eee;
  border: 1px solid #2a2a2a;
  border-radius: 14px;
  padding: 14px;
  font-size: 15px;
  font-weight: 500;
  letter-spacing: 0.3px;
}

.exercise-search {
  width: 100%;
  height: 36px;          /* â† í•µì‹¬ (ë³´í†µ 52~56pxì—ì„œ ì¤„ì„) */
  background: #111;      /* ì™„ì „ ë¸”ë™ âŒ ì‚´ì§ ë°ì€ ë¸”ë™ */
  color: #fff;
  border: 1px solid #333;
  border-radius: 8px;
  padding: 0 12px;
  font-size: 14px;
}

.exercise-search::placeholder {
  color: #777;
}

.exercise-search:focus {
  outline: none;
  border-color: #fff;
}
.search-wrap {
  margin-bottom: 12px;
}

   .search-wrap {
  display: flex;
  gap: 8px;
  margin-bottom: 12px;
}

.exercise-search {
  flex: 1;
  height: 36px;
  background: #111;
  color: #fff;
  border: 1px solid #333;
  border-radius: 8px;
  padding: 0 12px;
  font-size: 14px;
}

.add-btn {
  width: 36px;
  height: 36px;
  background: #000;
  color: #fff;
  border: 1px solid #333;
  border-radius: 8px;
  font-size: 20px;
  cursor: pointer;

  /* ğŸ”¥ ì´ 3ì¤„ì´ í•µì‹¬ */
  display: flex;
  align-items: center;
  justify-content: center;

  line-height: 1; /* ê¸€ì í”ë“¤ë¦¼ ë°©ì§€ */
}
.add-btn:active {
  background: #222;
  transform: scale(0.96);
}
.exercise-card {
cursor: pointer;
  padding: 14px 16px;
  display: flex;
  flex-direction: column;
  gap: 6px;
  border-radius: 14px;
  background: #111;
  border: 1px solid #222;
  transition: all 0.15s ease;
}

.exercise-card:hover {
  background: #161616;
  border-color: #333;
}

.exercise-card:active {
  transform: scale(0.985);
}

.exercise-name {
  font-size: 16px;
  font-weight: 600;
  color: #fff;
  letter-spacing: 0.3px;
}

.exercise-sub {
  font-size: 13px;
  color: #777;
}

.calendar-toggle {
  margin-top: 12px;
  padding: 8px 14px;
  border-radius: 8px;
  background: #2a2a2a;
  color: #eee;
  font-size: 13px;
  border: none;
  cursor: pointer;
}

.calendar-toggle.active {
  background: #8b0000;
  color: #fff;
}
/* í† ê¸€ ê°ì‹¸ëŠ” ì˜ì—­ */
.calendar-toggle-wrap {
  margin-top: 10px;
  display: flex;
  justify-content: flex-start; /* ì™¼ìª½ ì •ë ¬ */
}

/* ì•Œì•½ ìŠ¤ìœ„ì¹˜ */
.toggle-switch {
  width: 48px;          /* â† ê±°ì˜ 1/7 ëŠë‚Œ */
  height: 26px;
  background: #3a3a3a;
  border-radius: 999px;
  position: relative;
  cursor: pointer;
  transition: background 0.25s ease;
}

/* ì•ˆì— êµ¬ìŠ¬ */
.toggle-switch::after {
  content: "";
  width: 20px;
  height: 20px;
  background: #ddd;
  border-radius: 50%;
  position: absolute;
  top: 3px;
  left: 3px;
  transition: transform 0.25s ease;
}

/* ON ìƒíƒœ */
.toggle-switch.active {
  background: linear-gradient(135deg, #8b0000, #400000);
}

.toggle-switch.active::after {
  transform: translateX(22px);
}

/* ì¢…ëª© ëª¨ë“œ ì „ìš© */
.calendar.muscle-mode .days div {
  font-weight: 400;        /* ì–‡ê²Œ */
  font-size: 14px;         /* ë‚ ì§œë³´ë‹¤ ì‚´ì§ ì‘ê²Œ */
  letter-spacing: 0.2px;
}

/* ìš´ë™í•œ ë‚  ë°°ê²½ì€ ìœ ì§€ */
.calendar.muscle-mode .days div.done {
  font-weight: 400;
}

/* ë‚ ì§œ ëª¨ë“œëŠ” ì ˆëŒ€ ì˜í–¥ ì•ˆ ë°›ìŒ */
.record-horizontal {
  display: flex;
  gap: 12px;
  overflow-x: auto;
  padding: 10px 0;
}

.record-day {
  min-width: 120px;
  background: #111;
  border: 1px solid #222;
  border-radius: 12px;
  padding: 10px;
}

.record-day .date {
  font-size: 12px;
  color: #FFD700;
  text-align: center;
  margin-bottom: 8px;
}

.record-day .set {
  font-size: 17px;
  color: #eee;
  line-height: 1.6;
}
/* recordAdd ë²„íŠ¼ë§Œ ì‘ê²Œ */
#recordAdd {
  height: 40px;        /* kg / íšŒ ë³´ë‹¤ 2/3 */
  padding: 0 12px;
  font-size: 14px;
  border-radius: 8px;
  font-weight: 500;
}
.recordAddBtn {
  height: 40px;
  padding: 0 14px;
  font-size: 13px;
  border-radius: 999px;   /* ì•Œì•½í˜• */
  font-weight: 500;
  letter-spacing: 0.5px;

  background: #000;
  color: #fff;
  border: 1px solid #fff;
}
.exercise-card {
  position: relative;  /* ë²„íŠ¼ ìœ„ì¹˜ ì§€ì • ìœ„í•´ í•„ìš” */
}

.delete-btn {
  position: absolute;
  top: 8px;
  right: 8px;
  width: 28px;      /* ì¡°ê¸ˆ í‚¤ì›€ */
  height: 28px;
  background: none;
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
}

.delete-btn:hover svg {
  stroke: #ff5555; /* í˜¸ë²„ ì‹œ ë¹¨ê°• */
}


/* ë³´ì¡°ìš´ë™ ê¸°ë¡ ì„¸íŠ¸ ê¸€ì */
.record-set {
  font-size: 14.5px;     /* ê¸°ì¡´ 13px ì •ë„ â†’ ì‚´ì§ ì—… */
  line-height: 1.7;      /* ìˆ¨ ì¢€ ì‰¬ê²Œ */
  font-weight: 500;      /* ë„ˆë¬´ êµµì§€ ì•Šê²Œ */
}

/* ===============================
   âœ… í•˜ë‹¨ íƒ­ë°” (ì§„ì§œ ê³ ì • + 4ì¹¸ ë””ìì¸)
================================ */

/* íƒ­ë°” ë†’ì´ */
:root{
  --topBarH: 79px;          /* 55 + 12*2 = 79 */
  --bottomTabH: 88px;
}



/* âœ… ì§„ì§œ í•˜ë‹¨ ê³ ì • */
.bottomTab{
  position: fixed;
  left: 50%;
  transform: translateX(-50%);
  bottom: 0;

  width: 390px;
  max-width: 100%;

  height: var(--bottomTabH);
  padding-bottom: env(safe-area-inset-bottom);

  display: flex;
  background: rgba(0,0,0,0.92);
  backdrop-filter: blur(10px);

  border-top: 1px solid rgba(255,255,255,0.08);
  z-index: 99999;
}

/* âœ… â€œì¹¸ 4ê°œâ€ ëŠë‚Œ */
.bottomTab .tabBtn{
  flex: 1;
  height: 100%;
  margin: 0;

  border: none;
  background: transparent;

  color: #888;          /* ê¸°ë³¸ íšŒìƒ‰ */
  font-size: 14px;
  font-weight: 600;

  display: flex;
  align-items: flex-start;
  justify-content: center;

  cursor: pointer;

 padding-top: 18px;         /* ğŸ”¥ ì´ ê°’ìœ¼ë¡œ ìœ„ë¡œ ì˜¬ë¦¼ */
}

/* âœ… í™œì„±: ê¸€ìë§Œ ë…¸ë€ìƒ‰ */
.bottomTab .tabBtn.active{
  color: #FFD700;
  background: transparent;  /* ë°°ê²½ ì ˆëŒ€ ë³€ê²½ ì—†ìŒ */
}


.settings-btn {
  all: unset;              /* ğŸ”¥ ê¸°ë³¸ button ìŠ¤íƒ€ì¼ ì „ë¶€ ì œê±° */
  width: 24px;             /* í´ë¦­ ì˜ì—­ */
  height: 24px;

  font-size: 16px;         /* ì•„ì´ì½˜ í¬ê¸° */
  line-height: 1;

  color: #ddd;
  cursor: pointer;

  display: flex;
  align-items: center;
  justify-content: center;
}

.settings-btn:active {
  transform: scale(0.92);
}


.settings-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.4);
  z-index: 999999;
  display: flex;
  justify-content: flex-end;
}

.settings-overlay.hidden {
  display: none;
}

.settings-panel {
  width: 82%;
  max-width: 320px;
  height: 100%;
  background: #111;
  padding: 20px;
  box-sizing: border-box;

  transform: translateX(100%);
  animation: slideIn 0.25s ease forwards;
}

@keyframes slideIn {
  to { transform: translateX(0); }
}

/* í—¤ë” */
.settings-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
}

.settings-name {
  font-size: 16px;
  font-weight: 600;
}

.settings-email {
  font-size: 12px;
  color: #777;
}

/* ë¦¬ìŠ¤íŠ¸ */
.settings-list {
  border-top: 1px solid #222;
}

.settings-item {
  padding: 14px 0;
  border-bottom: 1px solid #222;
  font-size: 14px;
}

.settings-item.muted {
  color: #777;
}



/* ===== ì„¤ì • í™”ë©´ ë¦¬ìŠ¤íŠ¸ ëŠë‚Œ ===== */
.settings-section{
  margin-top: 6px;
  border-top: 1px solid #222;
  border-bottom: 1px solid #222;
}

.settings-row{
  width: 100%;
  background: transparent;
  border: none;
  color: #eee;
  padding: 14px 8px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  cursor: pointer;
  text-align: left;
}

.settings-row + .settings-row{
  border-top: 1px solid #1f1f1f;
}

.settings-row.static{
  cursor: default;
}

.row-left{
  display:flex;
  flex-direction: column;
  gap: 2px;
}

.row-title{
  font-size: 15px;
  font-weight: 650;
}

.row-sub{
  font-size: 12px;
  color: #777;
}

.row-right{
  color: #777;
  font-size: 22px;
  line-height: 1;
}


/* ===== ë¡œê·¸ì•„ì›ƒ ëª¨ë‹¬ ===== */
.modal{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.55);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 200000;
}

.modal.hidden{ display:none; }

.modal-box{
  width: 86%;
  max-width: 340px;
  background: #1a1a1a;
  border-radius: 16px;
  overflow: hidden;
  border: 1px solid rgba(255,255,255,0.08);
}

.modal-title{
  padding: 16px 16px 8px;
  font-size: 16px;
  font-weight: 800;
  text-align: center;
}

.modal-desc{
  padding: 0 16px 14px;
  font-size: 12.5px;
  line-height: 1.55;
  color: #cfcfcf;
  text-align: center;
  opacity: 0.95;
}

.modal-actions{
  display: grid;
  grid-template-columns: 1fr 1fr;
  border-top: 1px solid rgba(255,255,255,0.08);
}

.modal-btn{
  background: transparent;
  border: none;
  padding: 14px 0;
  font-size: 14px;
  font-weight: 700;
  color: #8bbcff; /* ì·¨ì†Œ/ì¼ë°˜ */
  cursor: pointer;
}

.modal-btn + .modal-btn{
  border-left: 1px solid rgba(255,255,255,0.08);
}

.modal-btn.danger{
  color: #ff6b6b; /* í™•ì¸(ìœ„í—˜) */
}
   
   .settings-btn:focus-visible{
  outline: 2px solid rgba(255,215,0,0.7);
  outline-offset: 2px;
  border-radius: 8px;
}
/* ì„¤ì • íŒ¨ë„ X ë²„íŠ¼ */
#closeSettingsBtn{
  all: unset;
  width: 28px;         /* í´ë¦­ ì˜ì—­(ë„ˆë¬´ í¬ì§€ ì•Šê²Œ) */
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;

  font-size: 16px;     /* âœ• ìì²´ í¬ê¸° */
  line-height: 1;

  color: #aaa;
  cursor: pointer;
  border-radius: 8px;
}

#closeSettingsBtn:active{
  transform: scale(0.92);
  background: rgba(255,255,255,0.06);
}

.settings-header{
  padding-right: 2px;
}   

/* ì„¤ì • í™”ë©´ ë§¨ ë°‘ ë¡œê·¸ì•„ì›ƒ (í…ìŠ¤íŠ¸í˜•) */
.settings-logout-text{
  margin-top: 26px;          /* ê³µë°±ì— ë©ê·¸ëŸ¬ë‹ˆ */
  text-align: center;

  font-size: 12.5px;        /* ì‘ê²Œ */
  color: #777;              /* íšŒìƒ‰ */
  font-weight: 500;

  cursor: pointer;
}

.settings-logout-text:active{
  color: #ff6b6b;            /* ëˆŒë €ì„ ë•Œë§Œ ì‚´ì§ ë¹¨ê°• */
}

.settings-btn svg {
  display: block;
}

.settings-btn {
  color: #ddd;   /* ì•„ì´ì½˜ ìƒ‰ */
}

/* ===============================
   âœ… 1ë…„ ì§„í–‰ë¥  (ë‹¬ë ¥ ì•„ë˜)
================================ */
.year-progress{
  margin-top: 38px;
  padding: 16px 12px 14px;
  background: transparent;
  border-top: 1px solid rgba(255,255,255,0.06);
}

.year-progress-title{
  text-align: center;
  font-size: 16px;
  font-weight: 700;
  color: #eee;
  letter-spacing: 0.2px;
  margin-bottom: 6px;
}

.year-progress-sub{
  text-align: center;
  font-size: 13px;
  color: #888;
  margin-bottom: 12px;
}

/* ì¸ìŠ¤íƒ€/ê¹ƒí—ˆë¸Œ ëŠë‚Œ: 7í–‰(ìš”ì¼) x 53ì—´(ì£¼) */
.year-dots{
  display: grid;
  grid-template-columns: repeat(53, 1fr);
  grid-auto-rows: 10px;
  gap: 4px;
  width: 100%;
  max-width: 100%;
  margin: 0 auto;
}

.year-dot{
  width: 100%;
  height: 10px;
  border-radius: 999px;
  background: rgba(255,255,255,0.10); /* ê¸°ë³¸(ë¯¸ì§„í–‰) */
  border: 1px solid rgba(255,255,255,0.03);
}

/* ì§„í–‰ëœ ì  */
.year-dot.on{
  background: rgba(255,255,255,0.85);
  border-color: rgba(255,255,255,0.10);
}

/* ì˜¤ëŠ˜ ì  ê°•ì¡°(ì˜µì…˜) */
.year-dot.today{
  outline: 1px solid rgba(255,215,0,0.8);
  outline-offset: 1px;
}

.year-progress-foot{
  margin-top: 10px;
  text-align: right;
  font-size: 12px;
  color: #666;
}



   
/* .css ã…Šã„´ã„´ ë¶™ì—¬ë„£ê¸° */
   


   
/* ğŸ”¥ number input +/- ë²„íŠ¼ ì œê±° */
input[type="number"]::-webkit-outer-spin-button,
input[type="number"]::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

input[type="number"] {
    -moz-appearance: textfield; /* Firefox */
}
   /* ===============================
   1RM ì…ë ¥ í­ 2/3
================================ */
#tab1 #weight,
#tab1 #reps,
#tab1 #goBtn {
    width: 70%;
    padding: 10px;
    font-size: 16px;
    margin: 10px auto;
    display: block;
    border-radius: 14px;

    background: #111;
    color: #eee;
    border: 1px solid #2a2a2a;
}



#tableArea {
    margin-top: 30px;   /* ê¸°ì¡´ì— ì—†ìœ¼ë©´ ì¶”ê°€ */
    /* ë˜ëŠ” padding-top: 30px; */
}
/* ì¢…ëª© ëª¨ë“œ ê¸€ì”¨ì²´ */
.calendar.muscle-mode .days div {
  font-family:
    -apple-system,
    BlinkMacSystemFont,
    "SF Pro Text",
    "Apple SD Gothic Neo",
    "Noto Sans KR",
    "Segoe UI",
    sans-serif;
}
/* ===============================
   3ëŒ€ ì ‘ê¸° UI
================================ */
.three-header {
  position: relative;
  margin: 6px 0 6px;
  text-align: center;
}

/* 3ëŒ€ í…ìŠ¤íŠ¸ */
#total3{
  text-align: center;
  font-size: 28px;
  font-weight: 800;
  letter-spacing: 0.5px;
  line-height: 1.1;

  margin: 0;             /* âœ… ë‚´ë¶€ ì—¬ë°± ì œê±° */
  transform: translateY(-6px);  /* âœ… í™•ì‹¤íˆ ìœ„ë¡œ ë‹¹ê¹€ (ì›í•˜ë©´ -10pxë„ ê°€ëŠ¥) */

  color: #FFD700;
}

/* ì˜¤ë¥¸ìª½ ë²„íŠ¼ */
.three-toggle {
  position: absolute;
  right: 0;
  top: 50%;
  transform: translateY(-50%);
}


.three-toggle {
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: #333;
  border: none;
  cursor: pointer;
}

.three-toggle::after {
  content: "";
  width: 6px;
  height: 6px;
  background: #FFD700;
  border-radius: 50%;
  display: block;
  margin: auto;
}

/* ì ‘íŒ ìƒíƒœ */
#threeDetail {
  display: none;
}



   

    /* ìŠ¤íƒ€ì¼ ë§¨ë°‘ */
</style>
</head>

<body>
   
   
   
   <div class="topBar">
  <div class="topText">
    <div>ëŒ€ë¶€ë¶„ì˜ ë¬¸ì œëŠ” ëˆì´ ì—†ì–´ì„œ,</div>
    <div>ê·¸ ì™¸ì˜ ë¬¸ì œëŠ” ê·¼ìœ¡ì´ ì—†ì–´ì„œ ìƒê¸´ë‹¤</div>
  </div>

  <button id="openSettingsBtn" class="settings-btn" aria-label="ì„¤ì •">
  <svg
    width="18"
    height="18"
    viewBox="0 0 24 24"
    fill="none"
    stroke="currentColor"
    stroke-width="2"
    stroke-linecap="round"
    stroke-linejoin="round"
  >
    <circle cx="12" cy="12" r="3"></circle>
    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06
             a2 2 0 0 1-2.83 2.83l-.06-.06
             a1.65 1.65 0 0 0-1.82-.33
             a1.65 1.65 0 0 0-1 1.51V21
             a2 2 0 0 1-4 0v-.09
             a1.65 1.65 0 0 0-1-1.51
             a1.65 1.65 0 0 0-1.82.33l-.06.06
             a2 2 0 0 1-2.83-2.83l.06-.06
             a1.65 1.65 0 0 0 .33-1.82
             a1.65 1.65 0 0 0-1.51-1H3
             a2 2 0 0 1 0-4h.09
             a1.65 1.65 0 0 0 1.51-1
             a1.65 1.65 0 0 0-.33-1.82l-.06-.06
             a2 2 0 0 1 2.83-2.83l.06.06
             a1.65 1.65 0 0 0 1.82.33H9
             a1.65 1.65 0 0 0 1-1.51V3
             a2 2 0 0 1 4 0v.09
             a1.65 1.65 0 0 0 1 1.51
             a1.65 1.65 0 0 0 1.82-.33l.06-.06
             a2 2 0 0 1 2.83 2.83l-.06.06
             a1.65 1.65 0 0 0-.33 1.82V9
             a1.65 1.65 0 0 0 1.51 1H21
             a2 2 0 0 1 0 4h-.09
             a1.65 1.65 0 0 0-1.51 1z">
    </path>
  </svg>
</button>

</div>
   
<div class="app">
   
<div class="container">

<!-- 1RM -->
<div id="tab1" class="tabContent active">
  <input id="weight" type="number" placeholder="kg">
    <select id="reps"></select>
    <button id="goBtn">GO</button>
    <div id="result"></div>
    <div id="tableArea"></div>
</div>

<!-- 3ëŒ€ -->
<div id="tab2" class="tabContent">

   
     <!-- ğŸ”¥ í—¤ë” -->
  <div class="three-header">
    <div id="total3">3ëŒ€: 0 kg</div>
    <button id="threeToggleBtn" class="three-toggle"></button>
  </div>

  <!-- ğŸ”½ ì ‘íˆëŠ” ì˜ì—­ -->
  <div id="threeDetail">
    <table>
        <tr><th>ë²¤ì¹˜</th><th>ìŠ¤ì¿¼íŠ¸</th><th>ë°ë“œ</th></tr>
        <tr>
            <td><input id="benchRM" class="rmInput" type="number"></td>
            <td><input id="squatRM" class="rmInput" type="number"></td>
            <td><input id="deadRM" class="rmInput" type="number"></td>
        </tr>
    </table>

    <button id="save3Btn">3ëŒ€ ê¸°ë¡ ì €ì¥</button>
</div>
    <div class="recordFolders">
        <button class="folderBtn active" data-target="benchBox">ë²¤ì¹˜</button>
        <button class="folderBtn" data-target="squatBox">ìŠ¤ì¿¼íŠ¸</button>
        <button class="folderBtn" data-target="deadBox">ë°ë“œ</button>
       <button class="folderBtn" data-target="ohpBox">OHP</button>
    </div>

    <div id="benchBox" class="folderContent active"></div>
    <div id="squatBox" class="folderContent"></div>
    <div id="deadBox" class="folderContent"></div>
   <div id="ohpBox" class="folderContent"></div>

  <div class="recordFormRow">
    <input type="hidden" id="recordDate">

    <div class="dateDisplay">
        <div class="dateYear" id="displayYear">2026</div>
        <div class="dateMD" id="displayMD">01.09</div>
    </div>
<input id="recordWeight" type="number" placeholder="kg">
        <input id="recordReps" type="number" placeholder="íšŒ">
        <button id="recordAdd">ì €ì¥</button>
    </div>
    <!-- âœ… ì—¬ê¸° -->
    <div id="recordMessage"
         style="font-size:12px; color:#FFD700; margin-top:6px;">
    </div>


        
</div>
<div id="tab4" class="tabContent">

<div id="acc-part-screen">
  <button class="part-btn" data-part="chest">chest</button>
  <button class="part-btn" data-part="back">back</button>
  <button class="part-btn" data-part="shoulder">shoulder</button>
  <button class="part-btn" data-part="leg">leg</button>
  <button class="part-btn" data-part="arm">arm</button>
</div>

<div id="exercise-screen" style="display:none;">
  <div id="exercise-header" style="margin-bottom:10px; cursor:pointer;">
    â† <span id="current-part-name"></span>
  </div>

<div class="search-wrap">
  <input
    id="exercise-search"
    class="exercise-search"
    placeholder="ì¢…ëª© ê²€ìƒ‰"
  />
  <button id="add-exercise-btn" class="add-btn">+</button>
</div>


  <div id="exercise-list"></div>
</div>

   <div id="exercise-detail-screen" style="display:none;">

  <div style="margin-bottom:10px; cursor:pointer;"
       onclick="closeExerciseDetail()">
    â† <span id="detail-exercise-name"></span>
  </div>

  <!-- ê¸°ë¡ ì…ë ¥ -->
  <div class="recordFormRow">
    <input id="acc-weight" type="number" placeholder="kg">
    <input id="acc-reps" type="number" placeholder="íšŒ">
     <button id="add-btn" class="recordAddBtn" onclick="addAccessorySet()">ì € ì¥</button>


  </div>

  <!-- ê°€ë¡œ ê¸°ë¡ ì˜ì—­ -->
  <div id="acc-records" class="record-horizontal"></div>

</div>
</div>



   
<div id="save3Result"></div>
<!-- ë‹¬ë ¥ -->
<div id="tab3" class="tabContent">
    <div class="calendar">
        <div class="header">
    <button id="calPrev" class="month-btn">&lt;</button>
    <div id="calMonth" class="month-title"></div>
    <button id="calNext" class="month-btn">&gt;</button>
</div>
        <div class="weekdays">
           <div>ì¼</div>
           <div>ì›”</div>
           <div>í™”</div>
           <div>ìˆ˜</div>
           <div>ëª©</div>
           <div>ê¸ˆ</div>
           <div>í† </div>
        </div>
        <div id="calDays" class="days"></div>
    
      <div class="calendar-toggle-wrap">
     
  <div id="calendarToggle" class="toggle-switch"></div>
</div>
<!-- âœ… 1ë…„ ì§„í–‰ë¥  (ë‹¬ë ¥ ì•„ë˜) -->
<div class="year-progress" id="yearProgress">
  <div class="year-progress-title" id="yearProgressTitle">2026ë…„ ì§„í–‰ë¥ </div>
  <div class="year-progress-sub" id="yearProgressSub">0%</div>

  <div class="year-dots" id="yearDots"></div>

  <div class="year-progress-foot">
    <span id="yearProgressCount">0/365</span>
  </div>
</div>


    


    </div>
</div>
<!-- ì˜ˆì • -->
<div id="tab5" class="tabContent">
  <div style="padding:20px 0; text-align:center; color:#777; font-size:13px;">
    ì˜ˆì •(ì¤€ë¹„ì¤‘)
  </div>
</div>


   
</div>

<!-- âœ… í•˜ë‹¨ íƒ­ë°” (ìƒˆë¡œ ì¶”ê°€/ì´ë™) -->
<div class="bottomTab">
  <button class="tabBtn active" data-target="tab1">1RM</button>
  <button class="tabBtn" data-target="tab2">3ëŒ€</button>
  <button class="tabBtn" data-target="tab3">ë‹¬ë ¥</button>
  <button class="tabBtn" data-target="tab4">ê¸°ë¡</button>
   <button class="tabBtn" data-target="tab5">ì˜ˆì •</button>
</div>


   
<!-- íŒì—… -->
<div id="calPopup" class="popup hidden">
    <div class="popup-box">
        <h3 id="calPopupDate"></h3>
        <div class="muscles">
            <button data-muscle="ê°€ìŠ´">ê°€ìŠ´</button>
            <button data-muscle="ë“±">ë“±</button>
            <button data-muscle="íŒ”">íŒ”</button>
            <button data-muscle="í•˜ì²´">í•˜ì²´</button>
            <button data-muscle="ì–´ê¹¨">ì–´ê¹¨</button>
        </div>
    </div>
</div>

<div id="settingsOverlay" class="settings-overlay hidden">
  <div class="settings-panel">
    
    <!-- í—¤ë” -->
    <div class="settings-header">
      <div>
        <div id="settingsUserName" class="settings-name">ê²ŒìŠ¤íŠ¸</div>
        <div id="settingsUserEmail" class="settings-email"></div>
      </div>
      <button id="closeSettingsBtn">âœ•</button>
    </div>

<!-- âœ… í”„ë¡œí•„/ë¡œê·¸ì¸ ì˜ì—­ -->
<div class="settings-section">
  <!-- ê²ŒìŠ¤íŠ¸ì¼ ë•Œë§Œ ë³´ì¼ "ë¡œê·¸ì¸ í•˜ê¸°" -->
  <button id="settingsLoginRow" class="settings-row">
    <div class="row-left">
      <div class="row-title" style="color:#4aa3ff;">ë¡œê·¸ì¸ í•˜ê¸°</div>
      <div class="row-sub">ë‚´ ì •ë³´ ìˆ˜ì •</div>
    </div>
    <div class="row-right">â€º</div>
  </button>

  <!-- ë¡œê·¸ì¸ ìƒíƒœì¼ ë•Œë§Œ ë³´ì¼ "ê³„ì •" -->
  <div id="settingsAccountRow" class="settings-row static">
    <div class="row-left">
      <div class="row-title" id="settingsNameBig">ê²ŒìŠ¤íŠ¸</div>
      <div class="row-sub" id="settingsEmailSub">ë¡œê·¸ì¸í•˜ì§€ ì•ŠìŒ</div>
    </div>
  </div>
</div>
 
     <!-- ë©”ë‰´ -->
    <div class="settings-list">
      <div class="settings-item">ë¬¸ì˜</div>
      <div class="settings-item muted">ê¹€ë¬´ì§„í•œí…Œ ë¬¸ì˜í•˜ì„¸ìš”</div>
    </div>

<!-- âœ… í•˜ë‹¨ ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ (iOS ëŠë‚Œ) -->
<div id="settingsLogoutText" class="settings-logout-text">
  ë¡œê·¸ì•„ì›ƒ
</div>


  </div>
</div>

<div id="loginArea" style="display:none;">
  <button id="googleLoginBtn">Google ë¡œê·¸ì¸</button>
  <button id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</button>
  <div id="userInfo"></div>
</div>

<!-- âœ… ë¡œê·¸ì•„ì›ƒ í™•ì¸ íŒì—… -->
<div id="logoutModal" class="modal hidden">
  <div class="modal-box">
    <div class="modal-title">ë¡œê·¸ì•„ì›ƒ</div>
    <div class="modal-desc">
      ë¡œê·¸ì•„ì›ƒ ìƒíƒœì—ì„œëŠ” ê¸°ë¡ëœ ìš´ë™ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>
      ë˜í•œ ë¡œê·¸ì•„ì›ƒ ìƒíƒœì—ì„œ ì‘ì„±ëœ ëª¨ë“  ê¸°ë¡ì€, ì•± ì‚­ì œì‹œ ë³µì›í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br><br>
      ì •ë§ ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
    </div>

    <div class="modal-actions">
      <button id="logoutCancel" class="modal-btn">ì·¨ì†Œ</button>
      <button id="logoutConfirm" class="modal-btn danger">í™•ì¸</button>
    </div>
  </div>
</div>



   
<!--  </body> ëë‚˜ê¸° ì „ì— ì•„ë˜ íŒì—…-->


<!-- ğŸ”¥ JSëŠ” ë„¤ ê¸°ì¡´ ê·¸ëŒ€ë¡œ ë¶™ì´ë©´ ì •ìƒ ì‘ë™ -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script>
   
/* ê¸°ë¡ ë°•ìŠ¤ ë°ì´í„° (ë¡œì»¬ mock) ë° ë Œë” í•¨ìˆ˜ */
const records = { bench: [], squat: [], dead: [], ohp: [] };
     let calData = {}; // ğŸ”¥ Firestoreì—ì„œ ì±„ìš¸ ì˜ˆì •
/* Firebase ì„¤ì • (ê¸°ì¡´ ê°’ ìœ ì§€) */
const firebaseConfig = {
    apiKey: "AIzaSyCXn174XsW6ndqaeUpVK6XAAf4MR0-q7_k",
    authDomain: "rmpj-7ca13.firebaseapp.com",
    projectId: "rmpj-7ca13",
    storageBucket: "rmpj-7ca13.firebasestorage.app",
    messagingSenderId: "983484366324",
    appId: "1:983484366324:web:5fd58faba825ee39decda1"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
let currentExercises = [];
/* ìš”ì†Œ ì°¸ì¡° */
const tabBtns = document.querySelectorAll('.tabBtn');
const tabContents = document.querySelectorAll('.tabContent');

const weightSelect = document.getElementById('weight');
const repsSelect = document.getElementById('reps');
const goBtn = document.getElementById('goBtn');
const resultDiv = document.getElementById('result');
const tableArea = document.getElementById('tableArea');

const benchRM = document.getElementById('benchRM');
const squatRM = document.getElementById('squatRM');
const deadRM = document.getElementById('deadRM');
const total3 = document.getElementById('total3');

const save3Btn = document.getElementById('save3Btn');
const save3Result = document.getElementById('save3Result');

const folderBtns = document.querySelectorAll('.folderBtn');
const folderContents = document.querySelectorAll('.folderContent');

const benchBox = document.getElementById('benchBox');
const squatBox = document.getElementById('squatBox');
const deadBox = document.getElementById('deadBox');

const recordDate = document.getElementById('recordDate');
const recordWeight = document.getElementById('recordWeight');
const recordReps = document.getElementById('recordReps');
const recordAdd = document.getElementById('recordAdd');
const recordMessage = document.getElementById('recordMessage');

const googleLoginBtn = document.getElementById('googleLoginBtn');
const logoutBtn = document.getElementById('logoutBtn');
const userInfo = document.getElementById('userInfo');
   
// ğŸ”¥ 1RM íšŸìˆ˜ ì˜µì…˜ ì´ˆê¸°í™”
for (let i = 1; i <= 10; i++) {
  const opt = document.createElement("option");
  opt.value = i;
  opt.textContent = `${i}íšŒ`;
  repsSelect.appendChild(opt);
}




goBtn.addEventListener('click', ()=> {
    const weight = parseFloat(weightSelect.value);
    const reps = parseInt(repsSelect.value);

    if(!weight || !reps){
        tableArea.innerHTML = `<div style="text-align:center;color:#ff5555;margin-top:10px;">
                                   ë¬´ê²Œì™€ ë°˜ë³µìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”
                               </div>`;
        return;
    }

    const oneRM = weight * (1 + reps * 0.0333);

    // RMë§ˆë‹¤ ì„¸ë¡œ ê°„ê²© ë„“ê²Œ
    let html = '';
    for (let r=1; r<=10; r++){
        let rmWeight = oneRM / (1 + (r-1)*0.0333);
        html += `<div style="
                        text-align:center;
                        color:white;
                        margin:12px 0;   /* ê¸°ì¡´ 6px â†’ 12pxë¡œ ê°„ê²© ëŠ˜ë¦¼ */
                        font-size:16px;
                        font-weight:600;
                   ">
                        ${r}RM&nbsp;&nbsp;&nbsp;${rmWeight.toFixed(1)}kg
                 </div>`;
    }

    tableArea.innerHTML = html;
});

/* ===============================
   âœ… kg ì†Œìˆ˜ì  ì •ì±… ìœ í‹¸ (ì„¸íŠ¸ ê¸°ë¡ ì „ìš©)
   - ì €ì¥: 1ìë¦¬ ë°˜ì˜¬ë¦¼(ì˜ˆ: 95.55 -> 95.6)
   - í‘œì‹œ: .0ì´ë©´ ì •ìˆ˜ì²˜ëŸ¼(95.0 -> "95"), ì•„ë‹ˆë©´ 1ìë¦¬("95.5")
================================ */
function round1(n){
  const x = (typeof n === "number") ? n : parseFloat(n);
  if(!Number.isFinite(x)) return NaN;
  return Math.round(x * 10) / 10;
}

function formatKgSmart(n){
  const x = round1(n);
  if(!Number.isFinite(x)) return "";
  const s = x.toFixed(1);           // í•­ìƒ 1ìë¦¬ ë¬¸ìì—´
  return s.endsWith(".0") ? s.slice(0, -2) : s;  // í•„ìš”í•  ë•Œë§Œ ì†Œìˆ˜ì 
}

/* í˜ì´ë“œ í…ìŠ¤íŠ¸ ìœ í‹¸ */
function fadeOutElem(el, timeout=1000, fadeDur=800){
    el.style.opacity = 1;
    setTimeout(()=>{
        el.style.transition = `opacity ${fadeDur}ms ease`;
        el.style.opacity = 0;
        setTimeout(()=>{ el.innerHTML=''; el.style.opacity=1; el.style.transition=''; }, fadeDur);
    }, timeout);
}
function fadeTempMsg(el, msg, timeout=1000, fadeDur=800){
    el.innerHTML = msg;
    el.style.opacity = 1; 
    setTimeout(()=>{
        el.style.transition = `opacity ${fadeDur}ms ease`;
        el.style.opacity = 0;
        setTimeout(()=>{ el.innerHTML=''; el.style.opacity=1; el.style.transition=''; }, fadeDur);
    }, timeout);
}

/*********************************
 * âœ… ê²ŒìŠ¤íŠ¸ ëª¨ë“œ ë¡œì»¬ ì €ì¥ ì—”ì§„
 *********************************/
const LS_KEYS = {
  three: "mf_threeRM_v1",
  records: "mf_records_v1",              // bench/squat/dead
  calendar: "mf_calendar_v1",            // calData
  accessoriesList: (part) => `mf_acc_list_${part}_v1`,   // partë³„ ì¢…ëª© ë¦¬ìŠ¤íŠ¸
  accessoryRecords: "mf_acc_records_v1"  // ë³´ì¡°ìš´ë™ ê¸°ë¡ ì „ì²´
};

function lsGet(key, fallback){
  try{
    const raw = localStorage.getItem(key);
    if(!raw) return fallback;
    return JSON.parse(raw);
  }catch(e){
    return fallback;
  }
}
function lsSet(key, value){
  try{
    localStorage.setItem(key, JSON.stringify(value));
  }catch(e){}
}

/* âœ… ë¡œì»¬ì—ì„œ ì „ì²´ ë¶ˆëŸ¬ì˜¤ê¸° */
function loadAllFromLocal(){
  // 3ëŒ€
  const three = lsGet(LS_KEYS.three, {bench:0,squat:0,dead:0});
  benchRM.value = three.bench || 0;
  squatRM.value = three.squat || 0;
  deadRM.value  = three.dead  || 0;
  updateTotal3();

  // 3ëŒ€ ê¸°ë¡(ë²¤/ìŠ¤/ë°ë“œ ì„¸íŠ¸ ê¸°ë¡)
  const r = lsGet(LS_KEYS.records, {bench:[],squat:[],dead:[],ohp:[]});
  records.bench = Array.isArray(r.bench) ? r.bench : [];
  records.squat = Array.isArray(r.squat) ? r.squat : [];
  records.dead  = Array.isArray(r.dead)  ? r.dead  : [];
  records.ohp = Array.isArray(r.ohp) ? r.ohp : [];

  renderActiveBox();

  // ë‹¬ë ¥
  calData = lsGet(LS_KEYS.calendar, {});
  calRender();

  // ë³´ì¡°ìš´ë™ ê¸°ë¡
  accRecordsByExercise = lsGet(LS_KEYS.accessoryRecords, {});
  if(!accRecordsByExercise || typeof accRecordsByExercise !== "object") accRecordsByExercise = {};
}

/* âœ… ë¡œì»¬ë¡œ ì „ì²´ ì €ì¥ */
function saveThreeToLocal(){
  lsSet(LS_KEYS.three, {
    bench: parseInt(benchRM.value)||0,
    squat: parseInt(squatRM.value)||0,
    dead:  parseInt(deadRM.value)||0
  });
}
function saveRecordsToLocal(){
  lsSet(LS_KEYS.records, {
  bench: records.bench || [],
  squat: records.squat || [],
  dead:  records.dead  || [],
  ohp:   records.ohp   || []    // âœ…
});
}
function saveCalendarToLocal(){
  lsSet(LS_KEYS.calendar, calData || {});
}
function saveAccRecordsToLocal(){
  lsSet(LS_KEYS.accessoryRecords, accRecordsByExercise || {});
}
function saveAccListToLocal(part, list){
  lsSet(LS_KEYS.accessoriesList(part), list || []);
}
function loadAccListFromLocal(part){
  return lsGet(LS_KEYS.accessoriesList(part), []);
}

/* âœ… ê²ŒìŠ¤íŠ¸ìš© createdAt ìˆ«ì í†µì¼ */
function normalizeCreatedAt(v){
  if(!v) return 0;
  // Firestore Timestamp í˜•íƒœë©´ .toMillis ìˆì„ ìˆ˜ ìˆìŒ
  if(typeof v?.toMillis === "function") return v.toMillis();
  // ì´ë¯¸ ìˆ«ìë©´
  if(typeof v === "number") return v;
  // ê¸°íƒ€ë©´ 0
  return 0;
}


   
   /* ===============================
   ğŸ”¥ ë³´ì¡°ìš´ë™(4ë²ˆì§¸ íƒ­) ë¡œì§
================================ */


let accRecordsByExercise = {}; // ğŸ”¥ DBì—ì„œ ê°€ì ¸ì˜¬ ì˜ˆì •


let currentExerciseName = null; // ğŸ”¥ ì§€ê¸ˆ ë³´ê³  ìˆëŠ” ì¢…ëª©
let currentPart = null;        // ğŸ”¥ ì§€ê¸ˆ ì„ íƒëœ ì¢…ëª©

const exerciseListEl = document.getElementById('exercise-list');
const addExerciseBtn = document.getElementById('add-exercise-btn');
   
addExerciseBtn.addEventListener('click', addExercise);
const partButtons = document.querySelectorAll('.part-btn');


const currentPartNameEl = document.getElementById('current-part-name');

partButtons.forEach(btn => {
  btn.addEventListener('click', async ()=>{
    currentPart = btn.dataset.part;   // ğŸ”¥ í˜„ì¬ ì„ íƒí•œ ì¢…ëª© ì €ì¥
    currentPartNameEl.textContent = currentPart;
    partScreen.style.display = 'none';
    exerciseScreen.style.display = 'block';

    // Firestoreì—ì„œ í•´ë‹¹ ì¢…ëª© ë¶ˆëŸ¬ì˜¤ê¸°
    await loadExercises(currentPart);
  });
});



const detailScreen = document.getElementById('exercise-detail-screen');


   /* ===============================
   ì¹´ë“œ ìƒì„¸ ì—´ê¸°
================================ */


function openExerciseDetail(name) {
  currentExerciseName = name;

  if (!accRecordsByExercise[name]) accRecordsByExercise[name] = [];

  exerciseScreen.style.display = 'none';
  detailScreen.style.display = 'block';
  document.getElementById('detail-exercise-name').textContent = name;

  renderAccessoryRecords(name); // âœ… "ë””í…Œì¼ í™”ë©´"ì—ëŠ” ì´ê±¸ ì“°ì
}

function closeExerciseDetail() {
  detailScreen.style.display = 'none';
  exerciseScreen.style.display = 'block';
  currentExerciseName = null;
}



/* ===============================
   ì¹´ë“œ ìƒì„¸ ë Œë”ë§ (í•µì‹¬)
================================ */
function renderAccessoryRecords(exerciseName) {
  const el = document.getElementById('acc-records');
  if (!el) return;

  const list = accRecordsByExercise[exerciseName] || [];

  if (!list.length) {
    el.innerHTML = `<div style="color:#777;font-size:13px;">ê¸°ë¡ ì—†ìŒ</div>`;
    return;
  }

  // âœ… ìµœì‹  ê¸°ë¡ì´ ë¨¼ì € ì˜¤ë„ë¡ ì •ë ¬ (ë‚´ë¦¼ì°¨ìˆœ)
  const sorted = [...list].sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));

  // âœ… ë‚ ì§œë³„ ê·¸ë£¹í™” (ì •ë ¬ëœ ìƒíƒœ ìœ ì§€)
  const grouped = {};
  sorted.forEach(r => {
    const dateKey = r.date || "ë‚ ì§œì—†ìŒ";
    if (!grouped[dateKey]) grouped[dateKey] = [];
    grouped[dateKey].push(r);
  });

  // âœ… ë‚ ì§œë„ ìµœì‹ ì´ ì™¼ìª½(ë¨¼ì €) ë‚˜ì˜¤ê²Œ: ë‚´ë¦¼ì°¨ìˆœ
  const dates = Object.keys(grouped).sort((a, b) => b.localeCompare(a));

  // âœ… ë‚ ì§œ 1ê°œë‹¹ ì¹´ë“œ 1ê°œ, ê·¸ ì•ˆì— ì„¸íŠ¸ ì—¬ëŸ¬ ì¤„ (ìµœì‹ ì´ ìœ„ â†’ ì•„ë˜ë¡œ ëˆ„ì )
  el.innerHTML = dates.map(date => {
    // grouped[date]ëŠ” ì´ë¯¸ ìµœì‹ ìˆœìœ¼ë¡œ ë“¤ì–´ê°€ ìˆìŒ
    // "ìµœì‹ ì´ ì•„ë˜"ë¡œ í•˜ê³  ì‹¶ìœ¼ë©´ reverse() í•˜ë©´ ë¨
   const sets = grouped[date]
  .slice()
  .reverse()
  .map(r => `
    <div class="set record-set" data-id="${r.id}">
      ${r.weight}kg Ã— ${r.reps}íšŒ
    </div>
  `)
  .join("");

    return `
      <div class="record-day">
        <div class="date">${date}</div>
        ${sets}
      </div>
    `;
  }).join("");
}






let exercisesByPart = {}; // ğŸ”¥ ì¢…ëª© ëª©ë¡ ì „ìš©

async function addExercise() {
  if (!currentPart) return alert("ë¨¼ì € ë¶€ìœ„ë¥¼ ì„ íƒí•˜ì„¸ìš”.");

  const name = prompt("ìš´ë™ ì¢…ëª©ì„ ì…ë ¥í•˜ì‹œì˜¤");
  if (!name) return;

  const clean = name.trim();
  if (!clean) return;

  // âœ… í•µì‹¬: í˜„ì¬ í™”ë©´ì˜ ëª©ë¡(currentExercises)ì— ì¶”ê°€
  currentExercises = (currentExercises || []).filter(x => typeof x === 'string' && x.trim());

  if (currentExercises.includes(clean)) {
    alert("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì¢…ëª©ì…ë‹ˆë‹¤.");
    return;
  }

  currentExercises.unshift(clean);   // ìµœì‹ ì´ ìœ„
  renderExercises();
   // âœ… ê²ŒìŠ¤íŠ¸/ë¡œê·¸ì¸ ê³µí†µ: ë¡œì»¬ ì €ì¥
saveAccListToLocal(currentPart, currentExercises);

  const user = auth.currentUser;
  if (user) {
    await db
      .collection('users')
      .doc(user.uid)
      .collection('accessories')
      .doc(currentPart)
      .set({ list: currentExercises }, { merge: true });
  }
}






/* 3ëŒ€ ì´í•© ì—…ë°ì´íŠ¸ */
function updateTotal3(){
    const b = parseInt(benchRM.value)||0;
    const s = parseInt(squatRM.value)||0;
    const d = parseInt(deadRM.value)||0;
    total3.textContent = `3ëŒ€: ${b+s+d} kg`;

     // âœ… ê²ŒìŠ¤íŠ¸/ë¡œê·¸ì¸ ëª¨ë‘ ë¡œì»¬ ì €ì¥
     saveThreeToLocal();
}
[benchRM, squatRM, deadRM].forEach(el => el.addEventListener('input', updateTotal3));



/* save3Btn: ì „ì²´(3ëŒ€) ì €ì¥ â€” í•­ìƒ ë³´ì´ì§€ë§Œ FirestoreëŠ” ë¡œê·¸ì¸ ìˆì„ ë•Œë§Œ ì €ì¥ */
save3Btn.addEventListener('click', async ()=>{

    const user = auth.currentUser;

    if(!user){
        showSave3Message('ë¡œê·¸ì¸ í›„ ì €ì¥í•´ì£¼ì„¸ìš”');
        return;
    }

    const bench = parseInt(benchRM.value)||0;
    const squat = parseInt(squatRM.value)||0;
    const dead = parseInt(deadRM.value)||0;
    const total = bench + squat + dead;

    if(total === 0){
        showSave3Message('ê°’ì„ ì…ë ¥í•˜ì„¸ìš”');
        return;
    }

    try{
        await db
          .collection('users')
          .doc(user.uid)
          .collection('threeRM') // ğŸ”¥ ìˆ«ì ì œê±°
          .add({
              bench,
              squat,
              dead,
              total,
              createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });

        showSave3Message('3ëŒ€ ê¸°ë¡ ì €ì¥ ì™„ë£Œ!');
    }catch(e){
        console.error('3ëŒ€ ì €ì¥ ì—ëŸ¬:', e);
        showSave3Message('ì €ì¥ ì‹¤íŒ¨ (ì½˜ì†” í™•ì¸)');
    }
});

/* í´ë” ë²„íŠ¼ ë™ì‘ (ê°€ë¡œ ë²„íŠ¼ â†’ í•˜ë‚˜ì˜ ë°•ìŠ¤ë§Œ active) */
folderBtns.forEach(btn=>{
    btn.addEventListener('click', ()=>{
        folderBtns.forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const target = btn.dataset.target;
        folderContents.forEach(fc=>{
            if(fc.id === target) fc.classList.add('active');
            else fc.classList.remove('active');
        });
       renderActiveBox();
    });
});


async function loadRecordsFromFirestore(user){
  // ì´ˆê¸°í™”
  records.bench = [];
  records.squat = [];
  records.dead = [];

  const snap = await db
    .collection('users')
    .doc(user.uid)
    .collection('records')
    .orderBy('createdAt', 'asc')
    .get();

  snap.forEach(doc=>{
    const data = doc.data();
    const item = {
      firestoreId: doc.id,
      date: data.date,
      weight: data.weight,
      reps: data.reps
    };

    if(data.lift === 'bench') records.bench.push(item);
    if(data.lift === 'squat') records.squat.push(item);
    if(data.lift === 'dead')  records.dead.push(item);
  });

  renderActiveBox(); // ğŸ”¥ í™”ë©´ ê°±ì‹ 
}

   

// í¬ë§· ë‚ ì§œ: '25.12.10'
function formatTodayYYMMDD(d = new Date()){
    const yy = String(d.getFullYear()).slice(2);
    const mm = String(d.getMonth()+1).padStart(2,'0');
    const dd = String(d.getDate()).padStart(2,'0');
    return `${yy}.${mm}.${dd}`;
}

// ì´ˆê¸° ë‚ ì§œ í‘œì‹œ
recordDate.value = formatTodayYYMMDD();

// ë Œë” í•¨ìˆ˜: í˜„ì¬ active folderì˜ ëª©ë¡ì„ ê·¸ë ¤ì¤Œ
function renderActiveBox(){
    const activeBtn = document.querySelector('.folderBtn.active');
    const target = activeBtn ? activeBtn.dataset.target : 'benchBox';
    let arr = [];
    if(target === 'benchBox') arr = records.bench;
    else if(target === 'squatBox') arr = records.squat;
    else if(target === 'deadBox') arr = records.dead;
    else if(target === 'ohpBox')  arr = records.ohp;

    const boxEl = document.getElementById(target);

    if(!arr || arr.length === 0){
        boxEl.innerHTML = `<div style="color:#777;font-size:13px;">ê¸°ë¡ì´ ì—¬ê¸°ì— ìŒ“ì…ë‹ˆë‹¤</div>`;
        return;
    }

    // âœ… ë‚ ì§œë³„ ê·¸ë£¹í™” (ê¸°ì¡´ ê·¸ëŒ€ë¡œ)
    const grouped = {};
    arr.forEach(it => {
      if (!grouped[it.date]) grouped[it.date] = [];
      grouped[it.date].push(it);
    });

    // âœ… ìµœì‹  ë‚ ì§œ ë¨¼ì € (ê¸°ì¡´ ê·¸ëŒ€ë¡œ)
    const dates = Object.keys(grouped)
      .sort((a, b) => b.localeCompare(a));

    // âœ… ì—¬ê¸°ë¶€í„°ê°€ "ë°°ì¹˜ ë³€ê²½" í•µì‹¬
    boxEl.innerHTML = dates.map(date => {
      // ğŸ”¥ ê°™ì€ ë‚ ì§œì˜ ì„¸íŠ¸ë“¤: ê¸°ì¡´ì²˜ëŸ¼ "ìµœì‹ ì´ ì•„ë˜ë¡œ" ë³´ì´ê²Œ reverse ìœ ì§€
      const dayRecords = grouped[date].slice().reverse();

      return `
        <div style="margin-bottom:10px;">
          ${dayRecords.map((r, idx) => `
            <!-- âœ… í•œ ì¤„ì„ 'ê¸°ë¡(ì™¼ìª½) / ë‚ ì§œ(ì˜¤ë¥¸ìª½)' 2ì»¬ëŸ¼ì²˜ëŸ¼ ê³ ì • -->
            <div style="display:flex; align-items:center; line-height:1.6;">
              
              <!-- âœ… (ì™¼ìª½) ê¸°ë¡: ì‚­ì œ long-press íƒ€ê²Ÿ(.record-line)ì€ ê·¸ëŒ€ë¡œ ìœ ì§€ -->
              <div
                class="record-line"
                data-id="${r.firestoreId ? r.firestoreId : ('local_' + r.localId)}"
                style="
                  flex: 1;
                  text-align: left;       /* ğŸ”¥ ì™¼ìª½ ì •ë ¬ */
                  cursor: pointer;
                "
              >
                ${r.weight}kg Ã— ${r.reps}íšŒ
              </div>

              <!-- âœ… (ì˜¤ë¥¸ìª½) ë‚ ì§œ: ì²« ì¤„ì—ë§Œ í‘œì‹œ / ê³ ì •í­ 90px ìœ ì§€ -->
              <div style="
                width: 90px;             /* ğŸ”¥ ë„¤ê°€ ë§í•œ 'ê³ ì •' */
                text-align: right;       /* ğŸ”¥ ì˜¤ë¥¸ìª½ ì •ë ¬ */
                color: rgba(255,255,255,0.75); /* ë‚ ì§œëŠ” ë©”íƒ€ë¼ ì‚´ì§ í†¤ ë‹¤ìš´(ì›í•˜ë©´ ë¹¼ë„ ë¨) */
                font-size: 13px;
              ">
                ${idx === 0 ? date : ''}
              </div>

            </div>
          `).join('')}
          <div style="border-bottom:1px solid rgba(255,255,255,0.12); margin-top:6px;"></div>
        </div>
      `;
    }).join('');
}
renderActiveBox();

/* ê¸°ë¡ ì¶”ê°€ (ê°€ë¡œ í¼ì—ì„œ ì €ì¥) */
recordAdd.addEventListener('click', async ()=>{
    console.log("ğŸ”¥ ì €ì¥ ë²„íŠ¼ í´ë¦­ë¨");
const weightRaw = parseFloat(recordWeight.value);
const reps = parseInt(recordReps.value, 10);

// âœ… kgëŠ” 1ìë¦¬ ë°˜ì˜¬ë¦¼í•´ì„œ "ì €ì¥ê°’"ì„ í†µì¼
const weight = round1(weightRaw);

  if(!Number.isFinite(weight) || !reps){
        fadeTempMsg(recordMessage, 'ë¬´ê²Œì™€ íšŸìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”', 900, 600);
        return;
    }

    const date = formatTodayYYMMDD();

    const activeBtn = document.querySelector('.folderBtn.active');
    const target = activeBtn ? activeBtn.dataset.target : 'benchBox';

    const lift =
  target === 'benchBox' ? 'bench' :
  target === 'squatBox' ? 'squat' :
  target === 'deadBox'  ? 'dead'  :
  'ohp';

    const item = {
        firestoreId: null,
       localId: Date.now() + Math.random(), // ğŸ”¥ ì¶”ê°€
        date,
        weight,
        reps
    };

if(lift === 'bench') records.bench.unshift(item);
if(lift === 'squat') records.squat.unshift(item);
if(lift === 'dead')  records.dead.unshift(item);
if(lift === 'ohp')   records.ohp.unshift(item);

    recordWeight.value = '';
    recordReps.value = '';
    fadeTempMsg(recordMessage, 'ê¸°ë¡ ì¶”ê°€ ì™„ë£Œ', 700, 600);
    renderActiveBox();
    saveRecordsToLocal(); // âœ… ì¶”ê°€

    const user = auth.currentUser;
    if(user){
        try{
            const docRef = await db
              .collection('users')
              .doc(user.uid)
              .collection('records')
              .add({
                lift,
                date,
                weight,
                reps,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
              });

            item.firestoreId = docRef.id;
           
        }catch(e){
            console.error('Firestore add err', e);
        }
    }
});


const settingsUserName = document.getElementById("settingsUserName");
const settingsUserEmail = document.getElementById("settingsUserEmail");
const settingsLogoutText = document.getElementById("settingsLogoutText");

/* ë¡œê·¸ì¸ (êµ¬ê¸€) */
googleLoginBtn.addEventListener('click', ()=>{
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider).catch(e=>alert('ë¡œê·¸ì¸ ì‹¤íŒ¨: '+e.message));
});
logoutBtn.addEventListener('click', ()=> auth.signOut());

auth.onAuthStateChanged(async user => {

  // âœ… (A) ìƒë‹¨ ë¡œê·¸ì¸ ì˜ì—­(ì—†ì„ ìˆ˜ë„ ìˆìœ¼ë‹ˆ null ì²´í¬)
  if (user) {
    if (googleLoginBtn) googleLoginBtn.style.display = "none";
    if (logoutBtn) logoutBtn.style.display = "block";
    if (userInfo) userInfo.textContent = user.displayName || user.email || "";
  } else {
    if (googleLoginBtn) googleLoginBtn.style.display = "block";
    if (logoutBtn) logoutBtn.style.display = "none";
    if (userInfo) userInfo.textContent = "";
  }

  // âœ… (B) ì„¤ì • íŒ¨ë„ UI ê°±ì‹  (ì´ê±¸ ì—¬ê¸° ë„£ëŠ” ê²Œ í¬ì¸íŠ¸)
  if (user) {
  if (settingsUserName) settingsUserName.textContent = user.displayName || "ì‚¬ìš©ì";
  if (settingsUserEmail) settingsUserEmail.textContent = ""; // âœ… í—¤ë” ì´ë©”ì¼ ìˆ¨ê¹€
} else {
  if (settingsUserName) settingsUserName.textContent = "ê²ŒìŠ¤íŠ¸";
  if (settingsUserEmail) settingsUserEmail.textContent = "ë¡œê·¸ì¸í•˜ì§€ ì•ŠìŒ";
}



   if (user) {
    if (settingsLoginRow) settingsLoginRow.style.display = "none";
    if (settingsAccountRow) settingsAccountRow.style.display = "flex";

    if (settingsNameBig) settingsNameBig.textContent = user.displayName || "ì‚¬ìš©ì";
    if (settingsEmailSub) settingsEmailSub.textContent = user.email || "";

    if (settingsLogoutText) settingsLogoutText.style.display = "block";
  } else {
    if (settingsLoginRow) settingsLoginRow.style.display = "flex";
    if (settingsAccountRow) settingsAccountRow.style.display = "none";

    if (settingsLogoutText) settingsLogoutText.style.display = "none";
  }
  // âœ… ì—¬ê¸°ë¶€í„°ëŠ” ë„¤ ê¸°ì¡´ ë¡œì§ ê·¸ëŒ€ë¡œ
  if (user) {

    /* 3ëŒ€ ìµœì‹ ê°’ */
    try {
      const threeSnap = await db
        .collection("users")
        .doc(user.uid)
        .collection("threeRM")
        .orderBy("createdAt", "desc")
        .limit(1)
        .get();

      if (!threeSnap.empty) {
        const data = threeSnap.docs[0].data();
        benchRM.value = data.bench || 0;
        squatRM.value = data.squat || 0;
        deadRM.value = data.dead || 0;
        updateTotal3();
      }
    } catch (e) {
      console.error("load threeRM err", e);
    }

    /* records */
    try {
      const snap = await db
        .collection("users")
        .doc(user.uid)
        .collection("records")
        .orderBy("createdAt", "desc")
        .limit(200)
        .get();

      records.bench = [];
      records.squat = [];
      records.dead = [];

      snap.forEach(doc => {
        const d = doc.data();
        if (!d || !d.lift) return;

        const item = {
          firestoreId: doc.id,
          date: d.date,
          weight: d.weight,
          reps: d.reps,
          createdAt: d.createdAt?.toMillis?.() || 0
        };

        if (d.lift === "bench") records.bench.push(item);
        if (d.lift === "squat") records.squat.push(item);
        if (d.lift === "dead")  records.dead.push(item);
        if (d.lift === "ohp")   records.ohp.push(item);
      });

      renderActiveBox();
    } catch (e) {
      console.error("load records err", e);
    }

    /* ë‹¬ë ¥ */
    try {
      const snap = await db
        .collection("users")
        .doc(user.uid)
        .collection("calendar")
        .get();

      calData = {};
      snap.forEach(doc => {
        calData[doc.id] = doc.data();
      });

      calRender();
    } catch (e) {
      console.error("calendar load error", e);
    }

    await loadAccessoryRecords();

  } else {
    // âœ… ê²ŒìŠ¤íŠ¸: ë¡œì»¬ì—ì„œ ì „ë¶€ ë³µì›
    loadAllFromLocal();

    currentExercises = [];
    renderExercises();
  }
});





 

/* ë©”ì‹œì§€ í˜ì´ë“œì•„ì›ƒ */
function showSave3Message(msg) {
    save3Result.textContent = msg;
    save3Result.style.opacity = 1;

    setTimeout(() => {
        save3Result.style.transition = "opacity 0.8s";
        save3Result.style.opacity = 0;

        setTimeout(() => {
            save3Result.textContent = "";
            save3Result.style.transition = "";
            save3Result.style.opacity = 1;
        }, 800);
    }, 1000);
}
   
function setTodayDisplay() {
    const now = new Date();
    const year = now.getFullYear();
    const mm = String(now.getMonth() + 1).padStart(2, '0');
    const dd = String(now.getDate()).padStart(2, '0');

    document.getElementById("displayYear").textContent = `${year}`;
    document.getElementById("displayMD").textContent = `${mm}.${dd}`;
}

setTodayDisplay();

/******** ë‹¬ë ¥ + long press ì½”ë“œ ì—¬ê¸° ********/
/********************
 * ğŸ“… ë‹¬ë ¥ ë¡œì§ (tab3)
 ********************/

const calDaysEl = document.getElementById("calDays");
const calMonthEl = document.getElementById("calMonth");
const calendarToggleBtn = document.getElementById("calendarToggle");

const calendarToggle = document.getElementById("calendarToggle");

calendarToggle.addEventListener("click", () => {
  calendarMode = calendarMode === "date" ? "muscle" : "date";
  calendarToggle.classList.toggle("active");

  document.querySelector(".calendar")
    .classList.toggle("muscle-mode", calendarMode === "muscle");

  calRender();
});


   
const calPopup = document.getElementById("calPopup");
const calPopupDate = document.getElementById("calPopupDate");
const calMuscleBtns = calPopup.querySelectorAll(".muscles button");

let calCurrent = new Date();
 
let calendarMode = "date"; 
// "date" | "muscle"

let calSelectedDate = null;
let calSelectedMuscles = [];


function calRender() {
  calDaysEl.innerHTML = "";

  const y = calCurrent.getFullYear();
  const m = calCurrent.getMonth();
  calMonthEl.textContent = `${y}ë…„ ${m + 1}ì›”`;

  const first = new Date(y, m, 1);
  const start = first.getDay();
  const last = new Date(y, m + 1, 0).getDate();

  // ë¹ˆì¹¸
 for (let i = 0; i < start; i++) {
  const empty = document.createElement("div");
  empty.classList.add("empty");
  calDaysEl.appendChild(empty);
}

  const today = new Date();

  for (let d = 1; d <= last; d++) {
    const cell = document.createElement("div");
    const key = `${y}-${m + 1}-${d}`;

    // ì˜¤ëŠ˜ í‘œì‹œ
    if (
      d === today.getDate() &&
      m === today.getMonth() &&
      y === today.getFullYear()
    ) {
      cell.classList.add("today");
    }

    // ìš´ë™í•œ ë‚ 
    if (calData[key]?.muscles?.length) {
      cell.classList.add("done");
    }

    if (calendarMode === "date") {
      cell.textContent = d;
    } else {
      if (calData[key]?.muscles?.length) {
        cell.textContent = calData[key].muscles[0];
      } else {
        cell.textContent = "";
      }
    }

 // long press (ë‚ ì§œ ëª¨ë“œì—ì„œë§Œ)
let timer;



cell.addEventListener("mouseup", () => clearTimeout(timer));



cell.addEventListener("touchend", () => clearTimeout(timer));


    calDaysEl.appendChild(cell);
  }
}


   



let longPressTimer = null;
let calPopupOpen = false;  // íŒì—… ì—´ë ¸ëŠ”ì§€ ì²´í¬


// ë‚ ì§œ long press
document.addEventListener("mousedown", e => handleDatePressStart(e));
document.addEventListener("touchstart", e => handleDatePressStart(e));

function handleDatePressStart(e){
    // âŒ ì¢…ëª© ëª¨ë“œì—ì„œëŠ” long press ìì²´ ì°¨ë‹¨
    if (calendarMode === "muscle") return;

    const cell = e.target.closest(".days div");
    if(!cell || !cell.textContent) return;

    const key = `${calCurrent.getFullYear()}-${calCurrent.getMonth()+1}-${cell.textContent}`;

    longPressTimer = setTimeout(() => {
        calOpenPopup(key);
    }, 500);
}

// âœ… íŒì—… ê·¼ìœ¡ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì—°ê²°
calMuscleBtns.forEach(btn => {
  btn.addEventListener("click", (e) => {
    e.preventDefault();
    e.stopPropagation();     // âœ… íŒì—… ë°°ê²½ í´ë¦­ ë‹«ê¸°ë‘ ì¶©ëŒ ë°©ì§€
    handleMuscleSelect(btn);
  });
});
calPopup.addEventListener("click", e => {
  if (e.target === calPopup) {
    calPopup.classList.add("hidden");
    calPopupOpen = false;   // âœ… ì¶”ê°€
  }
});


document.addEventListener("mouseup", e => clearLongPress(e));
document.addEventListener("touchend", e => clearLongPress(e));
document.addEventListener("touchmove", e => clearLongPress(e));

function clearLongPress(e){
    if(calPopupOpen) {
        // íŒì—… ì—´ë ¤ìˆìœ¼ë©´ long press ë¬´ì‹œ
        longPressTimer && clearTimeout(longPressTimer);
        longPressTimer = null;
        return;
    }
    longPressTimer && clearTimeout(longPressTimer);
    longPressTimer = null;
}





calPopup.addEventListener("click", e => {
  // ë°°ê²½ë§Œ í´ë¦­í•˜ë©´ ë‹«ê¸°, ë‚´ë¶€ ë°•ìŠ¤ í´ë¦­ì€ ë¬´ì‹œ
  if (e.target === calPopup) calPopup.classList.add("hidden");
});




   async function handleMuscleSelect(btn) {
  const user = auth.currentUser;
  const m = btn.dataset.muscle;
  const alreadySelected = calSelectedMuscles.includes(m);

  // âœ… 1) íŒì—…ì„ ë¨¼ì € ì¦‰ì‹œ ë‹«ì•„ì„œ "ë°˜ì‘"ì„ ë¹ ë¥´ê²Œ
  calPopup.classList.add("hidden");
  calPopupOpen = false;

  // âœ… 2) ì €ì¥/ë Œë” ê°™ì€ ë¬´ê±°ìš´ ì‘ì—…ì€ ë‹¤ìŒ í”„ë ˆì„ìœ¼ë¡œ ë„˜ê¹€
  requestAnimationFrame(async () => {

    calMuscleBtns.forEach(b => b.classList.remove("active"));

    if (alreadySelected) {
      delete calData[calSelectedDate];
      calSelectedMuscles = [];

      if (user) {
        await db.collection("users").doc(user.uid)
          .collection("calendar").doc(calSelectedDate).delete();
      }
    } else {
      calSelectedMuscles = [m];
      btn.classList.add("active");
      calData[calSelectedDate] = { muscles: [m] };

      if (user) {
        await db.collection("users").doc(user.uid)
          .collection("calendar").doc(calSelectedDate)
          .set({ muscles: [m], updatedAt: firebase.firestore.FieldValue.serverTimestamp() });
      }
    }

    // âœ… ê²ŒìŠ¤íŠ¸/ë¡œê·¸ì¸ ê³µí†µ ì €ì¥ + ë‹¬ë ¥ ë‹¤ì‹œê·¸ë¦¬ê¸°
    saveCalendarToLocal();
    calRender();
  });
}




function calOpenPopup(key) {
  calSelectedDate = key;
  calSelectedMuscles = calData[key]?.muscles || [];
  calPopupDate.textContent = key;

  calMuscleBtns.forEach(btn => {
    btn.classList.toggle("active", calSelectedMuscles.includes(btn.dataset.muscle));
  });

  calPopup.classList.remove("hidden");
  calPopupOpen = true;
}





   








document.getElementById("calPrev").onclick = () => {
  calCurrent.setMonth(calCurrent.getMonth() - 1);
  calRender();
};

document.getElementById("calNext").onclick = () => {
  calCurrent.setMonth(calCurrent.getMonth() + 1);
  calRender();
};

calRender();

   let recordPressTimer = null;

// PC
document.addEventListener("mousedown", e => {
  const line = e.target.closest(".record-line");
  if (!line) return;

  recordPressTimer = setTimeout(() => {
    if (confirm("ì´ ê¸°ë¡ì„ ì‚­ì œí• ê¹Œìš”?")) {
      deleteRecord(line.dataset.id);
    }
  }, 600);
});

document.addEventListener("mouseup", () => {
  clearTimeout(recordPressTimer);
});

// ëª¨ë°”ì¼
document.addEventListener("touchstart", e => {
  const line = e.target.closest(".record-line");
  if (!line) return;

  recordPressTimer = setTimeout(() => {
    if (confirm("ì´ ê¸°ë¡ì„ ì‚­ì œí• ê¹Œìš”?")) {
      deleteRecord(line.dataset.id);
    }
  }, 600);
});

document.addEventListener("touchend", () => {
  clearTimeout(recordPressTimer);
});

document.addEventListener("touchmove", () => {
  clearTimeout(recordPressTimer);
});


   
async function deleteRecord(id){
  if (!id) return;

  const isLocal = String(id).startsWith("local_");
  const pureId = isLocal ? id.replace("local_", "") : id;

  // 1ï¸âƒ£ ë¡œì»¬ ë°°ì—´ì—ì„œ ì œê±° (ê²ŒìŠ¤íŠ¸/ë¡œê·¸ì¸ ê³µí†µ)
  ["bench","squat","dead","ohp"].forEach(type => {
    records[type] = records[type].filter(r =>
      r.firestoreId !== pureId && String(r.localId) !== pureId
    );
  });

  renderActiveBox();
  saveRecordsToLocal(); // âœ… ë¡œì»¬ ì €ì¥

  // 2ï¸âƒ£ Firestore ì‚­ì œëŠ” "ì§„ì§œ firestoreId"ì¼ ë•Œë§Œ
  const user = auth.currentUser;
  if (user && !isLocal) {
    try {
      await db
        .collection('users')
        .doc(user.uid)
        .collection('records')
        .doc(id)
        .delete();
    } catch (e) {
      console.error("Firestore delete error:", e);
    }
  }
}




const partScreen = document.getElementById('acc-part-screen');
const exerciseScreen = document.getElementById('exercise-screen');
const partTitle = document.getElementById('current-part-name');
const partBtns = document.querySelectorAll('.part-btn');




document.getElementById('exercise-header').addEventListener('click', () => {
  exerciseScreen.style.display = 'none';
  partScreen.style.display = 'block';
});
const threeToggleBtn = document.getElementById("threeToggleBtn");
const threeDetail = document.getElementById("threeDetail");

threeToggleBtn.addEventListener("click", () => {
  threeDetail.style.display =
    threeDetail.style.display === "none" || !threeDetail.style.display
      ? "block"
      : "none";
});



   

function getToday() {
  const d = new Date();
  const y = d.getFullYear();
  const m = String(d.getMonth() + 1).padStart(2, '0');
  const day = String(d.getDate()).padStart(2, '0');
  return `${y}.${m}.${day}`;
}

   function formatAccDate(){
  const d = new Date();
  const yy = String(d.getFullYear()).slice(2);
  const mm = String(d.getMonth()+1).padStart(2,'0');
  const dd = String(d.getDate()).padStart(2,'0');
  return `${yy}.${mm}.${dd}`;
}

// âŒ ì´ 2ì¤„(ì¤‘ë³µ ì„ ì–¸) ì‚­ì œ/ë³€ê²½ í•„ìš”
// const tabBtns = document.querySelectorAll('.bottomTab .tabBtn');
// const tabContents = document.querySelectorAll('.tabContent');

// âœ… ì´ë ‡ê²Œ ë³€ê²½
const bottomTabBtns = document.querySelectorAll('.bottomTab .tabBtn');
const bottomTabContents = document.querySelectorAll('.tabContent');

bottomTabBtns.forEach(btn => {
  btn.addEventListener('click', () => {
    calPopup.classList.add("hidden");

    bottomTabBtns.forEach(b => b.classList.remove('active'));
    btn.classList.add('active');

    const target = btn.dataset.target;
    bottomTabContents.forEach(tc => {
      const on = (tc.id === target);
      tc.classList.toggle('active', on);
      tc.style.display = on ? 'block' : 'none';
    });

    document.querySelector('.app').scrollTo({ top: 0, behavior: 'auto' });

    // Tip íƒ­ ì´ˆê¸°í™”
    if (target === 'tab4') {
      partScreen.style.display = 'block';
      exerciseScreen.style.display = 'none';
      detailScreen.style.display = 'none';
    } else {
      detailScreen.style.display = 'none';
    }
  });
});








tabBtns.forEach(btn => {
  btn.addEventListener('click', () => {
    calPopup.classList.add("hidden");

    tabBtns.forEach(b => b.classList.remove('active'));
    btn.classList.add('active');

    const target = btn.dataset.target;
    tabContents.forEach(tc => {
      const on = (tc.id === target);
      tc.classList.toggle('active', on);
      tc.style.display = on ? 'block' : 'none';
    });
document.querySelector('.app').scrollTo({ top: 0, behavior: 'auto' });

    // Tip íƒ­ ì´ˆê¸°í™”
    if (target === 'tab4') {
      partScreen.style.display = 'block';
      exerciseScreen.style.display = 'none';
      detailScreen.style.display = 'none'; // âœ… ì¶”ê°€: ë””í…Œì¼ë„ ë‹«ê¸°
    } else {
      detailScreen.style.display = 'none';
    }
  });
});











// ì¹´ë“œ ë Œë”ë§
function renderExercises() {
  // âœ… ë£¨í”„ ì „ì— ë”± 1ë²ˆë§Œ ì •ë¦¬
  currentExercises = (currentExercises || [])
    .filter(x => typeof x === 'string' && x.trim());

  if (!currentExercises.length) {
    exerciseListEl.innerHTML =
      `<div style="color:#777;font-size:13px;">ì•„ì§ ì¶”ê°€ëœ ì¢…ëª©ì´ ì—†ìŠµë‹ˆë‹¤</div>`;
    return;
  }

  exerciseListEl.innerHTML = '';

  currentExercises.forEach(name => {
    const card = document.createElement('div');
    card.className = 'exercise-card';

    card.innerHTML = `
      <div class="exercise-name">${name}</div>
      <div class="exercise-sub">${getAccessorySummary(name)}</div>
      <button class="delete-btn" aria-label="ì‚­ì œ">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2"
             stroke-linecap="round" stroke-linejoin="round">
          <line x1="3" y1="4" x2="21" y2="4"></line>
          <rect x="6" y="6" width="12" height="14" rx="2"></rect>
          <line x1="10" y1="10" x2="10" y2="18"></line>
          <line x1="14" y1="10" x2="14" y2="18"></line>
        </svg>
      </button>
    `;

    card.addEventListener('click', () => openExerciseDetail(name));

    card.querySelector('.delete-btn').addEventListener('click', (e) => {
      e.stopPropagation();
      deleteExercise(name);
    });

    exerciseListEl.appendChild(card);
  });
}

   


async function deleteExercise(exerciseName) {
  if (!confirm('ì´ ì¢…ëª©ì˜ ëª¨ë“  ê¸°ë¡ì„ ì‚­ì œí• ê¹Œìš”?')) return;

  const user = auth.currentUser;

  // âœ… 1) ë¡œì»¬ ê¸°ë¡ì—ì„œ ì‚­ì œ (ê²ŒìŠ¤íŠ¸/ë¡œê·¸ì¸ ê³µí†µ)
  delete accRecordsByExercise[exerciseName];
  saveAccRecordsToLocal();

  // âœ… 2) í˜„ì¬ íŒŒíŠ¸ ëª©ë¡ì—ì„œë„ ì œê±° (ê²ŒìŠ¤íŠ¸/ë¡œê·¸ì¸ ê³µí†µ)
  if (currentPart) {
    currentExercises = (currentExercises || []).filter(n => n !== exerciseName);
    saveAccListToLocal(currentPart, currentExercises);
  }

  // âœ… 3) ë¡œê·¸ì¸ ìƒíƒœë©´ Firestoreë„ ì‚­ì œ
  if (user) {
    const snap = await db
      .collection('users')
      .doc(user.uid)
      .collection('accessoryRecords')
      .where('exercise', '==', exerciseName)
      .get();

    const batch = db.batch();
    snap.forEach(doc => batch.delete(doc.ref));
    await batch.commit();

    if (currentPart) {
      await db
        .collection('users')
        .doc(user.uid)
        .collection('accessories')
        .doc(currentPart)
        .set({ list: currentExercises }, { merge: true });
    }
  }

  renderExercises();
  if (currentExerciseName === exerciseName) closeExerciseDetail();
}



   

async function loadAccessoryRecords() {
  const user = auth.currentUser;
  if (!user) return;

  const snap = await db
    .collection('users')
    .doc(user.uid)
    .collection('accessoryRecords')
    .orderBy('createdAt', 'asc')
    .get();

  accRecordsByExercise = {};

  snap.forEach(doc => {
    const d = doc.data();
    if (!d.exercise) return;

    if (!accRecordsByExercise[d.exercise]) {
      accRecordsByExercise[d.exercise] = [];
    }

    accRecordsByExercise[d.exercise].push({
      id: doc.id,
      ...d
    });
  });

  renderExercises(); // ëª©ë¡
  if (currentExerciseName) {
    renderAccessoryRecords(currentExerciseName); // ì¹´ë“œ
  }
}


const backBtn = document.getElementById('exercise-back-btn'); // ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ID
if (backBtn) {
    backBtn.addEventListener('click', closeExerciseDetail);
}
// ë§¨ ìœ„ ë˜ëŠ” index.js ì ì ˆí•œ ìœ„ì¹˜



document.addEventListener('keydown', (e) => {
  if(e.key === "Escape") closeExerciseDetail();
});




async function saveExerciseToDB(exerciseName) {
    const user = auth.currentUser;
    if (!user) return;
    const docRef = db.collection('users').doc(user.uid).collection('accessories').doc(exerciseName);
    await docRef.set({
        name: exerciseName,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
    }, { merge: true });
}








async function loadExercises(part) {
  const user = auth.currentUser;

  if (!user) {
    // âœ… ê²ŒìŠ¤íŠ¸: ë¡œì»¬ì—ì„œ partë³„ ë¦¬ìŠ¤íŠ¸ ë¡œë“œ
    currentExercises = loadAccListFromLocal(part);
    currentExercises = (currentExercises || []).filter(x => typeof x === "string" && x.trim());
    renderExercises();
    return;
  }

  // âœ… ë¡œê·¸ì¸: Firestore
  const uid = user.uid;
  const doc = await db
    .collection('users')
    .doc(uid)
    .collection('accessories')
    .doc(part)
    .get();

  currentExercises = doc.exists ? (doc.data().list || []) : [];
  currentExercises = currentExercises.filter(x => typeof x === "string" && x.trim());
  renderExercises();
}


function getAccessorySummary(exerciseName) {
  const list = accRecordsByExercise[exerciseName] || [];
  if (!list.length) return 'ê¸°ë¡ ì—†ìŒ';

  // createdAt ê¸°ì¤€ ìµœì‹ ìˆœ ì •ë ¬
  const sorted = [...list].sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));

  // ìµœì‹  ë‚ ì§œ(ì²« ë ˆì½”ë“œì˜ date)
  const latestDate = sorted[0].date;
  if (!latestDate) return 'ê¸°ë¡ ì—†ìŒ';

  // ìµœì‹  ë‚ ì§œì— í•´ë‹¹í•˜ëŠ” ì„¸íŠ¸ë§Œ ëª¨ìœ¼ê¸°
  const sameDateSets = sorted.filter(r => r.date === latestDate);

  // ê°™ì€ ë‚ ì§œ ë‚´ì—ì„œëŠ” "ì €ì¥ ìˆœì„œ(ëˆ„ì )"ë¡œ ë³´ì´ê²Œ ìµœì‹ ì„ ì•„ë˜ë¡œ
  const lines = sameDateSets
    .slice()
    .reverse()
    .map(r => `${r.weight}kg Ã— ${r.reps}íšŒ`);

  // ì¤„ë°”ê¿ˆ ë Œë”ë§
  return `${latestDate}<br>${lines.join('<br>')}`;
}


async function addAccessorySet() {
  if (!currentExerciseName) return alert("ì¢…ëª©ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.");

  const w = parseFloat(document.getElementById("acc-weight").value);
  const r = parseInt(document.getElementById("acc-reps").value, 10);
  if (!w || !r) return alert("kg / íšŒë¥¼ ì…ë ¥í•˜ì„¸ìš”.");

  const user = auth.currentUser;

  // âœ… ê²ŒìŠ¤íŠ¸/ë¡œê·¸ì¸ ê³µí†µìœ¼ë¡œ ë¡œì»¬ì— ë¨¼ì € ë°˜ì˜í•  ì•„ì´í…œ
  const localItem = {
    id: "local_" + Date.now() + "_" + Math.random(),
    exercise: currentExerciseName,
    part: currentPart || "",
    weight: w,
    reps: r,
    date: formatTodayYYMMDD(),
    createdAt: Date.now()
  };

  if (!accRecordsByExercise[currentExerciseName]) {
    accRecordsByExercise[currentExerciseName] = [];
  }
  accRecordsByExercise[currentExerciseName].push(localItem);
  saveAccRecordsToLocal(); // âœ… ê²ŒìŠ¤íŠ¸ë„ ì €ì¥ë¨

  // âœ… ë¡œê·¸ì¸ ìƒíƒœë©´ Firestoreì—ë„ ì €ì¥ + idë¥¼ firestore idë¡œ ì—…ë°ì´íŠ¸
  if (user) {
    const item = {
      exercise: currentExerciseName,
      part: currentPart || "",
      weight: w,
      reps: r,
      date: formatTodayYYMMDD(),
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    };

    try {
      const docRef = await db
        .collection("users")
        .doc(user.uid)
        .collection("accessoryRecords")
        .add(item);

      // ë¡œì»¬ idë¥¼ firestore idë¡œ êµì²´(ì˜µì…˜ì´ì§€ë§Œ ê¹”ë”)
      localItem.id = docRef.id;
      saveAccRecordsToLocal();
    } catch (e) {
      console.error("accessoryRecords save err", e);
    }
  }

  // í™”ë©´ ê°±ì‹ 
  document.getElementById("acc-weight").value = "";
  document.getElementById("acc-reps").value = "";
  renderAccessoryRecords(currentExerciseName);
  renderExercises();
}


   let accDeleteTimer = null;

// PC
document.addEventListener("mousedown", e => {
  const setEl = e.target.closest(".record-set");
  if (!setEl) return;

  accDeleteTimer = setTimeout(() => {
    if (confirm("ì´ ê¸°ë¡ì„ ì‚­ì œí• ê¹Œìš”?")) {
      deleteAccessoryRecord(setEl.dataset.id);
    }
  }, 600);
});

document.addEventListener("mouseup", () => {
  clearTimeout(accDeleteTimer);
});

// ëª¨ë°”ì¼
document.addEventListener("touchstart", e => {
  const setEl = e.target.closest(".record-set");
  if (!setEl) return;

  accDeleteTimer = setTimeout(() => {
    if (confirm("ì´ ê¸°ë¡ì„ ì‚­ì œí• ê¹Œìš”?")) {
      deleteAccessoryRecord(setEl.dataset.id);
    }
  }, 600);
});

document.addEventListener("touchend", () => {
  clearTimeout(accDeleteTimer);
});
document.addEventListener("touchmove", () => {
  clearTimeout(accDeleteTimer);
});

async function deleteAccessoryRecord(recordId) {
  if (!recordId) return;

  // 1) ë¡œì»¬ì—ì„œ ì œê±° (ê²ŒìŠ¤íŠ¸/ë¡œê·¸ì¸ ê³µí†µ)
  Object.keys(accRecordsByExercise).forEach(exName => {
    accRecordsByExercise[exName] =
      (accRecordsByExercise[exName] || []).filter(r => r.id !== recordId);
  });
  saveAccRecordsToLocal();

  // 2) ë¡œê·¸ì¸ ìƒíƒœë©´ Firestoreì—ì„œë„ ì‚­ì œ
  const user = auth.currentUser;
  if (user) {
    // recordIdê°€ firestore idì¼ ë•Œë§Œ ì‹œë„
    if (!String(recordId).startsWith("local_")) {
      try {
        await db
          .collection("users")
          .doc(user.uid)
          .collection("accessoryRecords")
          .doc(recordId)
          .delete();
      } catch (e) {
        console.error("accessory record delete err", e);
      }
    }
  }

  // 3) í™”ë©´ ê°±ì‹ 
  if (currentExerciseName) renderAccessoryRecords(currentExerciseName);
  renderExercises();
}

const openSettingsBtn = document.getElementById("openSettingsBtn");
const closeSettingsBtn = document.getElementById("closeSettingsBtn");
const settingsOverlay = document.getElementById("settingsOverlay");

openSettingsBtn.addEventListener("click", () => {
  settingsOverlay.classList.remove("hidden");
});

closeSettingsBtn.addEventListener("click", () => {
  settingsOverlay.classList.add("hidden");
});

// ë°”ê¹¥ í´ë¦­ ì‹œ ë‹«ê¸°
settingsOverlay.addEventListener("click", (e) => {
  if (e.target === settingsOverlay) {
    settingsOverlay.classList.add("hidden");
  }
});


// âœ… ì„¤ì • í™”ë©´ìš© ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ìš”ì†Œ
const settingsLoginRow = document.getElementById("settingsLoginRow");
const settingsAccountRow = document.getElementById("settingsAccountRow");
const settingsNameBig = document.getElementById("settingsNameBig");
const settingsEmailSub = document.getElementById("settingsEmailSub");

// âœ… ë¡œê·¸ì•„ì›ƒ ëª¨ë‹¬ ìš”ì†Œ
const logoutModal = document.getElementById("logoutModal");
const logoutCancel = document.getElementById("logoutCancel");
const logoutConfirm = document.getElementById("logoutConfirm");

// âœ… êµ¬ê¸€ ë¡œê·¸ì¸ í•¨ìˆ˜ (ê²ŒìŠ¤íŠ¸ì—ì„œë„ ë™ì‘)
function doGoogleLogin(){
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider).catch(e => alert("ë¡œê·¸ì¸ ì‹¤íŒ¨: " + e.message));
}

// âœ… ì„¤ì • íŒ¨ë„ì—ì„œ "ë¡œê·¸ì¸ í•˜ê¸°" í´ë¦­ ì‹œ ë¡œê·¸ì¸
if (settingsLoginRow) {
  settingsLoginRow.addEventListener("click", () => {
    doGoogleLogin();
  });
}

// âœ… ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ëˆ„ë¥´ë©´ ëª¨ë‹¬ ë„ìš°ê¸°
if (settingsLogoutText) {
  settingsLogoutText.addEventListener("click", () => {
    logoutModal.classList.remove("hidden");
  });
}


// âœ… ëª¨ë‹¬ ì·¨ì†Œ/í™•ì¸
logoutCancel.addEventListener("click", () => {
  logoutModal.classList.add("hidden");
});

logoutConfirm.addEventListener("click", async () => {
  logoutModal.classList.add("hidden");
  await auth.signOut();
  settingsOverlay.classList.add("hidden");
});

// âœ… ëª¨ë‹¬ ë°”ê¹¥ í´ë¦­ ë‹«ê¸°
logoutModal.addEventListener("click", (e) => {
  if (e.target === logoutModal) logoutModal.classList.add("hidden");
});

/*********************************
 * âœ… 1ë…„ ì§„í–‰ë¥  (ë‹¬ë ¥ ì•„ë˜)
 *********************************/
function isLeapYear(y){
  return (y % 4 === 0 && y % 100 !== 0) || (y % 400 === 0);
}
function daysInYear(y){
  return isLeapYear(y) ? 366 : 365;
}
function dayOfYear(date){
  const start = new Date(date.getFullYear(), 0, 1);
  const diff = date - start;
  const oneDay = 24 * 60 * 60 * 1000;
  return Math.floor(diff / oneDay) + 1; // 1~365(366)
}

let yearDotsBuiltFor = null;

function buildYearDots(year){
  const dotsEl = document.getElementById("yearDots");
  if(!dotsEl) return;

  dotsEl.innerHTML = "";
  const total = daysInYear(year);

  // 7*53 = 371ì¹¸ ì¤‘ì—ì„œ totalë§Œí¼ë§Œ ì‚¬ìš©
  for(let i=1; i<=total; i++){
    const dot = document.createElement("div");
    dot.className = "year-dot";
    dot.dataset.day = String(i);
    dotsEl.appendChild(dot);
  }
  yearDotsBuiltFor = year;
}

function updateYearProgress(){
  const now = new Date();
  const year = now.getFullYear();

  const titleEl = document.getElementById("yearProgressTitle");
  const subEl   = document.getElementById("yearProgressSub");
  const countEl = document.getElementById("yearProgressCount");

  if(titleEl) titleEl.textContent = `${year}ë…„ ì§„í–‰ë¥ `;

  if(yearDotsBuiltFor !== year){
    buildYearDots(year);
  }

  const total = daysInYear(year);
  const passed = dayOfYear(now); // ì˜¤ëŠ˜ í¬í•¨
  const pct = Math.floor((passed / total) * 100);

  if(subEl) subEl.textContent = `${pct}%`;
  if(countEl) countEl.textContent = `${passed}/${total}`;

  // ì  ì¹ í•˜ê¸°
  const dots = document.querySelectorAll("#yearDots .year-dot");
  dots.forEach((dot, idx) => {
    const dayNum = idx + 1;
    dot.classList.toggle("on", dayNum <= passed);
    dot.classList.toggle("today", dayNum === passed);
  });
}

// ì´ˆê¸° 1íšŒ
updateYearProgress();

// â€œì‹¤ì‹œê°„ ìˆ˜ì¹˜ ë°˜ì˜â€ ëŠë‚Œ: 1ë¶„ë§ˆë‹¤ ê°±ì‹ (ë°°í„°ë¦¬ë„ ê´œì°®ìŒ)
setInterval(updateYearProgress, 60 * 1000);

   


   
</script>
<!-- âš ï¸ ì—¬ê¸° ì•„ë˜ì— ë„¤ê°€ ì“°ë˜ JS ã…“ã„´ ê·¸ëŒ€ë¡œ ìœ ì§€ -->
<script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("/sw.js");
  });
}
</script>
</body>
</html>