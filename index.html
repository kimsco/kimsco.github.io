<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>1RM ê³„ì‚°ê¸° + 3ëŒ€ ê¸°ë¡í‘œ</title>
<style>
body {
    background: black;
    color: white;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
    text-align: center;
    padding: 70px 20px 20px 20px;
}
.container { max-width: 400px; margin: auto; }
.subtitle { font-size:16px;  margin-top: 40px; margin-bottom: 20px; }

select, button {
    width:100%; padding:14px; margin:10px 0; font-size:18px;
    border-radius:10px; border:none; text-align:center;
}
button { font-size:20px; background:white; color:black; font-weight:bold; cursor:pointer; }
#result { margin-top:20px; font-size:22px; }
table { width:100%; margin-top:15px; border-collapse: collapse; }
table, td { border:1px solid white; }
td { padding:8px; text-align:center; }

#loginArea {
    position: absolute;
    top: 10px;
    left: 10px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    padding: 8px;
    background: rgba(0,0,0,0.5);
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
}
#loginArea button { padding: 8px 12px; font-size: 13px; border-radius:6px; }
#userInfo { font-size:12px; color:#fff; text-align:center; }

/* íƒ­ ìŠ¤íƒ€ì¼ */
.tab { display:flex; justify-content:center; gap:10px; margin-bottom:20px; }
.tab button { padding:10px 20px; border:none; border-radius:8px; cursor:pointer; background:#333; color:white; font-weight:bold; }
.tab button.active { background:#FFD700; color:black; }

/* íƒ­ ì»¨í…ì¸  ìˆ¨ê¸°ê¸° */
.tabContent { display:none; }
.tabContent.active { display:block; }

/* 3ëŒ€ ì´í•© ê°•ì¡° */
#total3 { font-size:28px; font-weight:bold; margin-bottom:15px; color:#FFD700; }

/* 3ëŒ€ ê¸°ë¡í‘œ ê°œì„  */
table.ThreeRM { margin:auto; width:100%; max-width:380px; }
table.ThreeRM td { padding:10px; width:33%; }
input.rmInput { width:100%; height:40px; font-size:18px; text-align:center; background:transparent; color:#fff; border-radius:6px; }

/* 3ëŒ€ ê¸°ë¡ ì €ì¥ ë²„íŠ¼ */
#save3Btn { 
    width:100%; 
    padding:14px; 
    font-size:18px; 
    margin-top:10px; 
    border-radius:10px; 
    border:none; 
    background:white; 
    color:black; 
    font-weight:bold; 
    cursor:pointer;
}

/* í´ë” ë²„íŠ¼ (ê°€ë¡œ ì •ë ¬) */
.recordFolders {
    display:flex;
    justify-content:center;
    gap:10px;
    margin-top:20px;
}
.folderBtn {
    padding:10px 12px;
    border:none;
    border-radius:8px;
    background:#333;
    color:white;
    font-weight:bold;
    cursor:pointer;
    min-width:100px;
}
.folderBtn.active {
    background:#FFD700;
    color:black;
}

/* í•˜ë‚˜ì˜ ë°•ìŠ¤(íƒ­ì²˜ëŸ¼ êµì²´) */
.folderContent {
    display:none;
    margin-top:15px;
    width:100%;
    height:150px;
    background:#555;
    border-radius:8px;
    padding:10px;
    box-sizing:border-box;
    text-align:left;
    overflow:auto;
}
.folderContent.active {
    display:block;
}

/* ì…ë ¥í¼ í•œì¤„ ê°€ë¡œë°°ì¹˜ */
.recordFormRow {
    display:flex;
    gap:8px;
    margin-top:12px;
    width:100%;
    max-width:380px;
    margin-left:auto;
    margin-right:auto;
}
.recordFormRow .r-date {
    width:30%;
    padding:8px;
    border-radius:6px;
    border:none;
    background:#333;
    color:#fff;
    text-align:center;
}
.recordFormRow input[type="number"] {
    flex:1;
    padding:8px;
    border-radius:6px;
    border:none;
    font-size:16px;
    box-sizing:border-box;
}
.recordFormRow button {
    padding:8px 10px;
    border-radius:6px;
    border:none;
    background:#fff;
    color:#000;
    font-weight:700;
    cursor:pointer;
}

/* í˜ì´ë“œ ë©”ì‹œì§€ */
.fade {
    transition: opacity 0.8s ease;
}
#save3Result { margin-top:10px; font-size:16px; opacity:1; }
#recordMessage { margin-top:8px; font-size:14px; opacity:1; color:#fff; }


/* ìˆ«ì ì…ë ¥ì°½ì˜ + - ë²„íŠ¼ ì œê±° (í¬ë¡¬, ì—£ì§€) */
input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

/* íŒŒì´ì–´í­ìŠ¤ */
input[type="number"] {
    -moz-appearance: textfield;
}





    
/* ë¡œê·¸ì¸ area hide on scroll */
</style>
</head>
<body>

<div class="container">
    <div class="subtitle">"ëŒ€ë¶€ë¶„ì˜ ë¬¸ì œëŠ” ëˆì´ ì—†ì–´ì„œ, ê·¸ ì™¸ì˜ ë¬¸ì œëŠ” ê·¼ìœ¡ì´ ì—†ì–´ì„œ ìƒê¸´ë‹¤"</div>
    <h2>1RM ê³„ì‚°ê¸°</h2>

    <!-- íƒ­ -->
    <div class="tab">
        <button class="tabBtn active" data-target="tab1">1RM ê³„ì‚°ê¸°</button>
        <button class="tabBtn" data-target="tab2">3ëŒ€ ê¸°ë¡í‘œ</button>
    </div>

    <!-- 1RM ê³„ì‚°ê¸° -->
    <div id="tab1" class="tabContent active">
        <select id="weight"><option value="">ë¬´ê²Œ ì„ íƒ</option></select>
        <select id="reps"><option value="">ë°˜ë³µìˆ˜ ì„ íƒ</option></select>
        <button id="goBtn">GO</button>
        <div id="result"></div>
        <div id="tableArea"></div>
        <div id="saveResult" style="margin-top:20px; font-size:18px;"></div>
    </div>

    <!-- 3ëŒ€ ê¸°ë¡í‘œ -->
    <div id="tab2" class="tabContent">
        <div id="total3">3ëŒ€: 0 kg</div>
        <table class="ThreeRM">
            <tr>
                <td>ë²¤ì¹˜</td>
                <td>ìŠ¤ì¿¼íŠ¸</td>
                <td>ë°ë“œ</td>
            </tr>
            <tr>
                <td><input type="number" id="benchRM" class="rmInput" placeholder="kg" min="0"></td>
                <td><input type="number" id="squatRM" class="rmInput" placeholder="kg" min="0"></td>
                <td><input type="number" id="deadRM" class="rmInput" placeholder="kg" min="0"></td>
            </tr>
        </table>

        <!-- ê¸°ì¡´ 3ëŒ€ ì €ì¥ ë²„íŠ¼ (í•­ìƒ ë³´ì„) -->
        <button id="save3Btn">3ëŒ€ ê¸°ë¡ ì €ì¥</button>
        <div id="save3Result" class="fade" style="margin-top:8px;font-size:15px;"></div>

        <!-- í´ë” ë²„íŠ¼ (ê°€ë¡œ) -->
        <div class="recordFolders" role="tablist" aria-label="ê¸°ë¡ íƒ­">
            <button class="folderBtn active" data-target="benchBox">ë²¤ì¹˜ ê¸°ë¡</button>
            <button class="folderBtn" data-target="squatBox">ìŠ¤ì¿¼íŠ¸ ê¸°ë¡</button>
            <button class="folderBtn" data-target="deadBox">ë°ë“œ ê¸°ë¡</button>
        </div>

        <!-- í•˜ë‚˜ì˜ ë°•ìŠ¤ ì˜ì—­ (ë²„íŠ¼ ëˆ„ë¥´ë©´ ë‚´ìš© êµì²´) -->
        <div id="benchBox" class="folderContent active"></div>
        <div id="squatBox" class="folderContent"></div>
        <div id="deadBox" class="folderContent"></div>

        <!-- ì…ë ¥í¼ (ê°€ë¡œ í•œì¤„) -->
        <div class="recordFormRow">
            <input type="text" id="recordDate" class="r-date" readonly />
            <input type="number" id="recordWeight" placeholder="ë¬´ê²Œ(kg)" />
            <input type="number" id="recordReps" placeholder="íšŸìˆ˜" />
            <button id="recordAdd">ì €ì¥</button>
        </div>
        <div id="recordMessage" class="fade"></div>
    </div>
</div>

<!-- ë¡œê·¸ì¸ ì˜ì—­ -->
<div id="loginArea">
    <button id="googleLoginBtn">Google ë¡œê·¸ì¸</button>
    <button id="logoutBtn" style="display:none;">ë¡œê·¸ì•„ì›ƒ</button>
    <div id="userInfo"></div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script>
/* Firebase ì„¤ì • (ê¸°ì¡´ ê°’ ìœ ì§€) */
const firebaseConfig = {
    apiKey: "AIzaSyCXn174XsW6ndqaeUpVK6XAAf4MR0-q7_k",
    authDomain: "rmpj-7ca13.firebaseapp.com",
    projectId: "rmpj-7ca13",
    storageBucket: "rmpj-7ca13.firebasestorage.app",
    messagingSenderId: "983484366324",
    appId: "1:983484366324:web:5fd58faba825ee39decda1"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

/* ìš”ì†Œ ì°¸ì¡° */
const tabBtns = document.querySelectorAll('.tabBtn');
const tabContents = document.querySelectorAll('.tabContent');

const weightSelect = document.getElementById('weight');
const repsSelect = document.getElementById('reps');
const goBtn = document.getElementById('goBtn');
const resultDiv = document.getElementById('result');
const tableArea = document.getElementById('tableArea');

const benchRM = document.getElementById('benchRM');
const squatRM = document.getElementById('squatRM');
const deadRM = document.getElementById('deadRM');
const total3 = document.getElementById('total3');

const save3Btn = document.getElementById('save3Btn');
const save3Result = document.getElementById('save3Result');

const folderBtns = document.querySelectorAll('.folderBtn');
const folderContents = document.querySelectorAll('.folderContent');

const benchBox = document.getElementById('benchBox');
const squatBox = document.getElementById('squatBox');
const deadBox = document.getElementById('deadBox');

const recordDate = document.getElementById('recordDate');
const recordWeight = document.getElementById('recordWeight');
const recordReps = document.getElementById('recordReps');
const recordAdd = document.getElementById('recordAdd');
const recordMessage = document.getElementById('recordMessage');

const googleLoginBtn = document.getElementById('googleLoginBtn');
const logoutBtn = document.getElementById('logoutBtn');
const userInfo = document.getElementById('userInfo');

/* ë¬´ê²Œ/ë°˜ë³µ ì˜µì…˜ ì±„ìš°ê¸° (1RM ê³„ì‚°ê¸°) */
for (let w=0; w<=250; w+=5){
    let option = document.createElement("option");
    option.value = w; option.textContent = w + " kg";
    weightSelect.appendChild(option);
}
for (let r=1; r<=10; r++){
    let option = document.createElement("option");
    option.value = r; option.textContent = r + " íšŒ";
    repsSelect.appendChild(option);
}

/* íƒ­ ì „í™˜ (1RM / 3ëŒ€) - ê¸°ì¡´ ë™ì‘ ìœ ì§€ */
tabBtns.forEach(btn=>{
    btn.addEventListener('click', ()=>{
        tabBtns.forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const target = btn.dataset.target;
        tabContents.forEach(tc=>{
            if(tc.id === target){
                tc.classList.add('active');
                tc.style.display = 'block';
            } else {
                tc.classList.remove('active');
                tc.style.display = 'none';
            }
        });
    });
});
console.log('user:', auth.currentUser?.uid);

/* 1RM ê³„ì‚° (í˜ì´ë“œ ì œê±° ì™„ì „ ìˆ˜ì •ë³¸) */
goBtn.addEventListener('click', ()=>{
    const weight = parseFloat(weightSelect.value);
    const reps = parseInt(repsSelect.value);

    if(!weight || !reps){
        resultDiv.innerHTML = "ë¬´ê²Œì™€ ë°˜ë³µìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.";
        return;
    }

    const oneRM = weight * (1 + reps * 0.0333);

    // ê³„ì‚° ê²°ê³¼ ì¶œë ¥ (ì‚¬ë¼ì§€ì§€ ì•ŠìŒ)
    resultDiv.innerHTML = `ì˜ˆìƒ 1RM: <b>${oneRM.toFixed(1)} kg</b>`;

    // í‘œ ìƒì„±
    let html = `<table><tr><th>RM</th><th>ë¬´ê²Œ (kg)</th></tr>`;
    for (let r=1; r<=10; r++){
        let rmWeight = oneRM / (1 + (r-1)*0.0333);
        html += `<tr><td>${r}RM</td><td>${rmWeight.toFixed(1)} kg</td></tr>`;
    }
    html += `</table>`;

    tableArea.innerHTML = html;
});


/* í˜ì´ë“œ í…ìŠ¤íŠ¸ ìœ í‹¸ */
function fadeOutElem(el, timeout=1000, fadeDur=800){
    el.style.opacity = 1;
    setTimeout(()=>{
        el.style.transition = `opacity ${fadeDur}ms ease`;
        el.style.opacity = 0;
        setTimeout(()=>{ el.innerHTML=''; el.style.opacity=1; el.style.transition=''; }, fadeDur);
    }, timeout);
}
function fadeTempMsg(el, msg, timeout=1000, fadeDur=800){
    el.innerHTML = msg;
    el.style.opacity = 1;
    setTimeout(()=>{
        el.style.transition = `opacity ${fadeDur}ms ease`;
        el.style.opacity = 0;
        setTimeout(()=>{ el.innerHTML=''; el.style.opacity=1; el.style.transition=''; }, fadeDur);
    }, timeout);
}

/* 3ëŒ€ ì´í•© ì—…ë°ì´íŠ¸ */
function updateTotal3(){
    const b = parseInt(benchRM.value)||0;
    const s = parseInt(squatRM.value)||0;
    const d = parseInt(deadRM.value)||0;
    total3.textContent = `3ëŒ€: ${b+s+d} kg`;
}
[benchRM, squatRM, deadRM].forEach(el => el.addEventListener('input', updateTotal3));



/* save3Btn: ì „ì²´(3ëŒ€) ì €ì¥ â€” í•­ìƒ ë³´ì´ì§€ë§Œ FirestoreëŠ” ë¡œê·¸ì¸ ìˆì„ ë•Œë§Œ ì €ì¥ */
save3Btn.addEventListener('click', async ()=>{
    alert('í´ë¦­ë¨'); // ğŸ‘ˆ ì´ê±°
    const user = auth.currentUser;

    if(!user){
        showSave3Message('ë¡œê·¸ì¸ í›„ ì €ì¥í•´ì£¼ì„¸ìš”');
        return;
    }

    const bench = parseInt(benchRM.value)||0;
    const squat = parseInt(squatRM.value)||0;
    const dead = parseInt(deadRM.value)||0;
    const total = bench + squat + dead;

    if(total === 0){
        showSave3Message('ê°’ì„ ì…ë ¥í•˜ì„¸ìš”');
        return;
    }

    try{
        await db
          .collection('users')
          .doc(user.uid)
          .collection('threeRM') // ğŸ”¥ ìˆ«ì ì œê±°
          .add({
              bench,
              squat,
              dead,
              total,
              createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });

        showSave3Message('3ëŒ€ ê¸°ë¡ ì €ì¥ ì™„ë£Œ!');
    }catch(e){
        console.error('3ëŒ€ ì €ì¥ ì—ëŸ¬:', e);
        showSave3Message('ì €ì¥ ì‹¤íŒ¨ (ì½˜ì†” í™•ì¸)');
    }
});

/* í´ë” ë²„íŠ¼ ë™ì‘ (ê°€ë¡œ ë²„íŠ¼ â†’ í•˜ë‚˜ì˜ ë°•ìŠ¤ë§Œ active) */
folderBtns.forEach(btn=>{
    btn.addEventListener('click', ()=>{
        folderBtns.forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const target = btn.dataset.target;
        folderContents.forEach(fc=>{
            if(fc.id === target) fc.classList.add('active');
            else fc.classList.remove('active');
        });
    });
});

/* ê¸°ë¡ ë°•ìŠ¤ ë°ì´í„° (ë¡œì»¬ mock) ë° ë Œë” í•¨ìˆ˜ */
const records = { bench: [], squat: [], dead: [] };

// í¬ë§· ë‚ ì§œ: '25.12.10'
function formatTodayYYMMDD(d = new Date()){
    const yy = String(d.getFullYear()).slice(2);
    const mm = String(d.getMonth()+1).padStart(2,'0');
    const dd = String(d.getDate()).padStart(2,'0');
    return `${yy}.${mm}.${dd}`;
}

// ì´ˆê¸° ë‚ ì§œ í‘œì‹œ
recordDate.value = formatTodayYYMMDD();

// ë Œë” í•¨ìˆ˜: í˜„ì¬ active folderì˜ ëª©ë¡ì„ ê·¸ë ¤ì¤Œ
function renderActiveBox(){
    const activeBtn = document.querySelector('.folderBtn.active');
    const target = activeBtn ? activeBtn.dataset.target : 'benchBox';
    let arr = [];
    if(target === 'benchBox') arr = records.bench;
    else if(target === 'squatBox') arr = records.squat;
    else if(target === 'deadBox') arr = records.dead;

    const boxEl = document.getElementById(target);
    if(!arr || arr.length === 0){
        boxEl.innerHTML = `<div style="color:#ddd">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤. ì•„ë˜ì—ì„œ ë¬´ê²Œ/íšŸìˆ˜ ì…ë ¥ í›„ 'ì €ì¥' ë²„íŠ¼ì„ ëˆŒëŸ¬ ê¸°ë¡í•˜ì„¸ìš”.</div>`;
        return;
    }
    // ìµœì‹  ìœ„ë¡œ
    boxEl.innerHTML = arr.map(it=>{
        return `<div style="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid rgba(255,255,255,0.06)"><div style="color:#ddd">${it.date}</div><div>${it.weight}kg Ã— ${it.reps}íšŒ</div></div>`;
    }).join('');
}
renderActiveBox();

/* ê¸°ë¡ ì¶”ê°€ (ê°€ë¡œ í¼ì—ì„œ ì €ì¥) */
recordAdd.addEventListener('click', async ()=>{
    const weight = parseInt(recordWeight.value);
    const reps = parseInt(recordReps.value);
    if(!weight || !reps){
        fadeTempMsg(recordMessage, 'ë¬´ê²Œì™€ íšŸìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”', 900, 600);
        return;
    }
    const date = recordDate.value || formatTodayYYMMDD();
    // í˜„ì¬ active folder
    const activeBtn = document.querySelector('.folderBtn.active');
    const target = activeBtn ? activeBtn.dataset.target : 'benchBox';
    // push into local records
    const item = { date, weight, reps };
    if(target === 'benchBox') records.bench.unshift(item);
    else if(target === 'squatBox') records.squat.unshift(item);
    else if(target === 'deadBox') records.dead.unshift(item);

    // clear inputs
    recordWeight.value = '';
    recordReps.value = '';

    // show local feedback
    fadeTempMsg(recordMessage, 'ê¸°ë¡ ì¶”ê°€ ì™„ë£Œ', 700, 600);
    renderActiveBox();

    // if logged in, also push to Firestore collection 'records'
    const user = auth.currentUser;
    if(user){
        try{
            await db.collection('users').doc(user.uid).collection('records').add({
                lift: target === 'benchBox' ? 'bench' : target === 'squatBox' ? 'squat' : 'dead',
                date, weight, reps, createdAt: new Date()
            });
        }catch(e){ console.error('Firestore add err', e); }
    }
});

/* ë¡œê·¸ì¸ (êµ¬ê¸€) */
googleLoginBtn.addEventListener('click', ()=>{
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider).catch(e=>alert('ë¡œê·¸ì¸ ì‹¤íŒ¨: '+e.message));
});
logoutBtn.addEventListener('click', ()=> auth.signOut());

/* auth ìƒíƒœ ë³€í™” */
auth.onAuthStateChanged(async user=>{
    if(user){
        googleLoginBtn.style.display = 'none';
        logoutBtn.style.display = 'block';
        userInfo.textContent = user.displayName || user.email || '';
        // ë¡œë“œ: Firestoreì— ìˆëŠ” ìµœê·¼ records ê°€ì ¸ì™€ ë®ì–´ì“°ì (ê°„ë‹¨)
        try{
            const snap = await db.collection('users').doc(user.uid).collection('records').orderBy('createdAt','desc').limit(200).get();
            // reset local
            records.bench = []; records.squat = []; records.dead = [];
            snap.forEach(doc=>{
                const d = doc.data();
                if(!d || !d.lift) return;
                const item = { date: d.date || formatTodayYYMMDD(new Date(d.createdAt?.toDate?.() || new Date())), weight: d.weight, reps: d.reps };
                if(d.lift === 'bench') records.bench.push(item);
                if(d.lift === 'squat') records.squat.push(item);
                if(d.lift === 'dead') records.dead.push(item);
            });
            // show latest on top
            records.bench = records.bench.reverse();
            records.squat = records.squat.reverse();
            records.dead = records.dead.reverse();
            renderActiveBox();
        }catch(e){ console.error('load records err', e); }
    } else {
        googleLoginBtn.style.display = 'block';
        logoutBtn.style.display = 'none';
        userInfo.textContent = '';
        // keep local records as-is (user might have local adds)
    }
});

/* ì´ˆê¸° í´ë” ë²„íŠ¼(ê°€ë¡œ) behavior already set; ensure renderActiveBox is called on tab change */
folderBtns.forEach(btn=>{
    btn.addEventListener('click', ()=>{
        // renderActiveBox will be called by the earlier folderBtns listener (it toggles active class),
        // but ensure we re-render for the selected folder:
        setTimeout(renderActiveBox, 0);
    });
});

/* ìŠ¤í¬ë¡¤ ì‹œ ë¡œê·¸ì¸ ìˆ¨ê¸°ê¸° (ì›ë˜ ë™ì‘ ìœ ì§€) */
window.addEventListener("scroll", ()=>{
    const loginArea = document.getElementById("loginArea");
    if(window.scrollY > 50) loginArea.style.display="none";
    else loginArea.style.display="flex";
});

 

/* ë©”ì‹œì§€ í˜ì´ë“œì•„ì›ƒ */
function showSave3Message(msg) {
    save3Result.textContent = msg;
    save3Result.style.opacity = 1;

    setTimeout(() => {
        save3Result.style.transition = "opacity 0.8s";
        save3Result.style.opacity = 0;

        setTimeout(() => {
            save3Result.textContent = "";
            save3Result.style.transition = "";
            save3Result.style.opacity = 1;
        }, 800);
    }, 1000);
}
</script>
</body>
</html>
