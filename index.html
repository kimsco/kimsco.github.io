<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>1RM ê³„ì‚°ê¸° + 3ëŒ€ ê¸°ë¡í‘œ</title>

<style>
/* ===============================
   ğŸ”¥ ì „ì²´ ë ˆì´ì•„ì›ƒ (í° ë¹„ìœ¨ ê³ ì •)
================================ */
body {
    margin: 0;
    background: #111;
    display: flex;
    justify-content: center;
    color: white;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
}

.app {
    width: 390px;          /* ì•„ì´í° ê¸°ì¤€ */
    min-height: 100vh;
    background: black;
    padding: 70px 20px 20px;
    box-sizing: border-box;
}

/* ===============================
   ê³µí†µ
================================ */
.container { max-width: 100%; margin: auto; }
.subtitle { font-size:16px; margin-bottom:20px; }

select, button, input {
    width:100%;
    padding:14px;
    margin:10px 0;
    font-size:18px;
    border-radius:10px;
    border:none;
    box-sizing: border-box;
}

button {
    background:white;
    color:black;
    font-weight:bold;
    cursor:pointer;
}

#result { margin-top:20px; font-size:22px; }

table {
    width:100%;
    margin-top:15px;
    border-collapse: collapse;
}
table, td, th {
    border:1px solid white;
}
td, th {
    padding:8px;
    text-align:center;
}

/* ===============================
   ë¡œê·¸ì¸ ì˜ì—­
================================ */
   .app {
   position: relative;
    overflow-x: hidden; /* ğŸ”¥ í˜¹ì‹œ ëª¨ë¥¼ íŠ ë°©ì§€ */
}
.topBar {
    position: absolute;
    top: 12px;
    right: 12px;
    max-width: calc(100% - 24px); /* ğŸ”¥ ì•ˆì „ì¥ì¹˜ */
}

#loginArea {
    display: flex;
    align-items: center;
    gap: 6px;
}

#loginArea button {
    padding: 6px 10px;
    font-size: 12px;
    border-radius: 6px;
    white-space: nowrap;
}

#userInfo {
    font-size: 11px;
    opacity: 0.8;
}


/* ===============================
   íƒ­
================================ */
.tab {
    display:flex;
    justify-content:center;
    gap:10px;
    margin-bottom:20px;
}
.tab button {
    background:#333;
    color:white;
    font-size:15px;
    padding:8px 12px;
}
.tab button.active {
    background:#FFD700;
    color:black;
}

.tabContent { display:none; }
.tabContent.active { display:block; }

/* ===============================
   3ëŒ€ ê¸°ë¡
================================ */
#total3 {
      text-align: center;        /* ê°€ìš´ë° */
    font-size: 28px;           /* í¼ì§ */
    font-weight: 800;          /* êµµê²Œ */
    letter-spacing: 0.5px;     /* ì‚´ì§ ê³ ê¸‰ */
    margin: 20px 0 16px;
    color: #FFD700;
}

.rmInput {
    height:40px;
    text-align:center;
    background:#222;
    color:white;
    border-radius:8px;
}

/* ===============================
   ê¸°ë¡ í´ë”
================================ */
.recordFolders {
    display:flex;
    gap:8px;
    margin-top:15px;
}
.folderBtn {
    flex:1;
    background:#333;
    color:white;
    padding:10px;
}
.folderBtn.active {
    background:#FFD700;
    color:black;
}

.folderContent {
    display:none;
    margin-top:10px;
    background:#444;
    border-radius:8px;
    padding:10px;
    height:150px;
    overflow:auto;
}
.folderContent.active { display:block; }

/* ===============================
   ê¸°ë¡ ì…ë ¥ í•œ ì¤„
================================ */
.recordFormRow {
    display:flex;
    gap:6px;
    align-items:center;
    margin-top:12px;
}


.recordFormRow input[type="number"] {
    height:40px;
    border-radius:8px;
    background:#222;
    color:white;
}

/* ===============================
   ë‹¬ë ¥
================================ */
.calendar .header {
    display: grid;
    grid-template-columns: 48px 1fr 40px;
    align-items: center;
    margin-bottom: 14px;
}
   .month-title {
    font-size: 16px;
    font-weight: 600;
    color: #eee;
    white-space: nowrap;   /* ğŸ”¥ ì¤„ë°”ê¿ˆ ë°©ì§€ */
    text-align: center;
}
 .month-btn {
    background: transparent;
    border: none;
    color: #8b0000; /* ì–´ë‘ìš´ ë¹¨ê°• */
    font-size: 18px;
    padding: 8px 10px;
    cursor: pointer;
    opacity: 0.7;
}

.month-btn:active {
    opacity: 1;
    transform: scale(0.95);
}  
/* ===== ìš”ì¼ ===== */
.weekdays {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    margin-bottom: 8px;
}

.weekdays div {
    text-align: center;
    font-size: 12px;
    color: #aaa;
    letter-spacing: 0.5px;
    padding-bottom: 6px;
}

/* ì¼ìš”ì¼ ë¹¨ê°„ í¬ì¸íŠ¸ */
.weekdays div:last-child {
    color: #8b0000;
}

   /* ===== ë‚ ì§œ ê·¸ë¦¬ë“œ ===== */
.days {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 10px;
}

/* ë‚ ì§œ ì…€ */
.days div {
    aspect-ratio: 1 / 1;
    background: #1a1a1a;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 15px;
    font-weight: 500;
    color: #eee;
    cursor: pointer;
    transition: all 0.18s ease;
}

/* hover (PC) */
.days div:hover {
    background: #2a2a2a;
    transform: translateY(-1px);
}

/* ì˜¤ëŠ˜ ë‚ ì§œ */
.days div.today {
    border: 1px solid #FFD700;
    color: #FFD700;
}

/* ìš´ë™í•œ ë‚  */
.days div.done {
    background: linear-gradient(135deg, #8b0000, #400000);
    color: white;
    font-weight: 600;
}

/* ë¹ˆì¹¸ (ì›” ì‹œì‘ ì „) */
.days div:empty {
    background: transparent;
    cursor: default;
}

   
/* ===============================
   íŒì—…
================================ */
.popup {
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.7);
    display:flex;
    justify-content:center;
    align-items:center;
    z-index:9999;
}
.popup.hidden { display:none; }
.popup-box {
    background:#111;
    padding:20px;
    border-radius:12px;
    width:80%;
}
.muscles {
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:10px;
    margin:15px 0;
}
.muscles button.active {
    background:#8b0000;
    color:white;
}
.dateDisplay {
    width: 80px;
    height: 40px;
    background: #222;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    line-height: 1.2;
    color: #FFD700;
}

.dateYear {
    font-size: 11px;
    opacity: 0.85;
}

.dateMD {
    font-size: 13px;
    font-weight: bold;
}
/* ğŸ”¥ number input +/- ë²„íŠ¼ ì œê±° */
input[type="number"]::-webkit-outer-spin-button,
input[type="number"]::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

input[type="number"] {
    -moz-appearance: textfield; /* Firefox */
}
</style>
</head>

<body>
<div class="app">
 <div class="topBar">
<div id="loginArea">
    <button id="googleLoginBtn">Google ë¡œê·¸ì¸</button>
    <button id="logoutBtn" style="display:none;">ë¡œê·¸ì•„ì›ƒ</button>
    <div id="userInfo"></div>
</div>

</div>
<div class="container">
<div class="subtitle">"ëŒ€ë¶€ë¶„ì˜ ë¬¸ì œëŠ” ëˆì´ ì—†ì–´ì„œ, ê·¸ ì™¸ì˜ ë¬¸ì œëŠ” ê·¼ìœ¡ì´ ì—†ì–´ì„œ ìƒê¸´ë‹¤"</div>

<!-- íƒ­ -->
<div class="tab">
    <button class="tabBtn active" data-target="tab1">1RM</button>
    <button class="tabBtn" data-target="tab2">3ëŒ€</button>
    <button class="tabBtn" data-target="tab3">ë‹¬ë ¥</button>
</div>

<!-- 1RM -->
<div id="tab1" class="tabContent active">
    <select id="weight"></select>
    <select id="reps"></select>
    <button id="goBtn">GO</button>
    <div id="result"></div>
    <div id="tableArea"></div>
</div>

<!-- 3ëŒ€ -->
<div id="tab2" class="tabContent">
    <div id="total3">3ëŒ€: 0 kg</div>
    <table>
        <tr><th>ë²¤ì¹˜</th><th>ìŠ¤ì¿¼íŠ¸</th><th>ë°ë“œ</th></tr>
        <tr>
            <td><input id="benchRM" class="rmInput" type="number"></td>
            <td><input id="squatRM" class="rmInput" type="number"></td>
            <td><input id="deadRM" class="rmInput" type="number"></td>
        </tr>
    </table>
    <button id="save3Btn">3ëŒ€ ê¸°ë¡ ì €ì¥</button>

    <div class="recordFolders">
        <button class="folderBtn active" data-target="benchBox">ë²¤ì¹˜</button>
        <button class="folderBtn" data-target="squatBox">ìŠ¤ì¿¼íŠ¸</button>
        <button class="folderBtn" data-target="deadBox">ë°ë“œ</button>
    </div>

    <div id="benchBox" class="folderContent active"></div>
    <div id="squatBox" class="folderContent"></div>
    <div id="deadBox" class="folderContent"></div>

  <div class="recordFormRow">
    <input type="hidden" id="recordDate">

    <div class="dateDisplay">
        <div class="dateYear" id="displayYear">2026</div>
        <div class="dateMD" id="displayMD">01.09</div>
    </div>
<input id="recordWeight" type="number" placeholder="kg">
        <input id="recordReps" type="number" placeholder="íšŒ">
        <button id="recordAdd">ì €ì¥</button>
    </div>
    <!-- âœ… ì—¬ê¸° -->
    <div id="recordMessage"
         style="font-size:12px; color:#FFD700; margin-top:6px;">
    </div>
</div>

        
</div>

   
<div id="save3Result"></div>
<!-- ë‹¬ë ¥ -->
<div id="tab3" class="tabContent">
    <div class="calendar">
        <div class="header">
    <button id="calPrev" class="month-btn">&lt;</button>
    <div id="calMonth" class="month-title"></div>
    <button id="calNext" class="month-btn">&gt;</button>
</div>
        <div class="weekdays">
            <div>ì›”</div><div>í™”</div><div>ìˆ˜</div><div>ëª©</div><div>ê¸ˆ</div><div>í† </div><div>ì¼</div>
        </div>
        <div id="calDays" class="days"></div>
    </div>
</div>

</div>

<!-- íŒì—… -->
<div id="calPopup" class="popup hidden">
    <div class="popup-box">
        <h3 id="calPopupDate"></h3>
        <div class="muscles">
            <button data-muscle="ê°€ìŠ´">ê°€ìŠ´</button>
            <button data-muscle="ë“±">ë“±</button>
            <button data-muscle="íŒ”">íŒ”</button>
            <button data-muscle="í•˜ì²´">í•˜ì²´</button>
        </div>
        <button id="calSave">ì™„ë£Œ</button>
    </div>
</div>

<!-- ë¡œê·¸ì¸ -->


<!-- ğŸ”¥ JSëŠ” ë„¤ ê¸°ì¡´ ê·¸ëŒ€ë¡œ ë¶™ì´ë©´ ì •ìƒ ì‘ë™ -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script>
/* Firebase ì„¤ì • (ê¸°ì¡´ ê°’ ìœ ì§€) */
const firebaseConfig = {
    apiKey: "AIzaSyCXn174XsW6ndqaeUpVK6XAAf4MR0-q7_k",
    authDomain: "rmpj-7ca13.firebaseapp.com",
    projectId: "rmpj-7ca13",
    storageBucket: "rmpj-7ca13.firebasestorage.app",
    messagingSenderId: "983484366324",
    appId: "1:983484366324:web:5fd58faba825ee39decda1"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

/* ìš”ì†Œ ì°¸ì¡° */
const tabBtns = document.querySelectorAll('.tabBtn');
const tabContents = document.querySelectorAll('.tabContent');

const weightSelect = document.getElementById('weight');
const repsSelect = document.getElementById('reps');
const goBtn = document.getElementById('goBtn');
const resultDiv = document.getElementById('result');
const tableArea = document.getElementById('tableArea');

const benchRM = document.getElementById('benchRM');
const squatRM = document.getElementById('squatRM');
const deadRM = document.getElementById('deadRM');
const total3 = document.getElementById('total3');

const save3Btn = document.getElementById('save3Btn');
const save3Result = document.getElementById('save3Result');

const folderBtns = document.querySelectorAll('.folderBtn');
const folderContents = document.querySelectorAll('.folderContent');

const benchBox = document.getElementById('benchBox');
const squatBox = document.getElementById('squatBox');
const deadBox = document.getElementById('deadBox');

const recordDate = document.getElementById('recordDate');
const recordWeight = document.getElementById('recordWeight');
const recordReps = document.getElementById('recordReps');
const recordAdd = document.getElementById('recordAdd');
const recordMessage = document.getElementById('recordMessage');

const googleLoginBtn = document.getElementById('googleLoginBtn');
const logoutBtn = document.getElementById('logoutBtn');
const userInfo = document.getElementById('userInfo');

/* ë¬´ê²Œ/ë°˜ë³µ ì˜µì…˜ ì±„ìš°ê¸° (1RM ê³„ì‚°ê¸°) */
for (let w=0; w<=250; w+=5){
    let option = document.createElement("option");
    option.value = w; option.textContent = w + " kg";
    weightSelect.appendChild(option);
}
for (let r=1; r<=10; r++){
    let option = document.createElement("option");
    option.value = r; option.textContent = r + " íšŒ";
    repsSelect.appendChild(option);
}

/* íƒ­ ì „í™˜ (1RM / 3ëŒ€) - ê¸°ì¡´ ë™ì‘ ìœ ì§€ */
tabBtns.forEach(btn=>{
    btn.addEventListener('click', ()=>{
        calPopup.classList.add("hidden");
        tabBtns.forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const target = btn.dataset.target;
        tabContents.forEach(tc=>{
            if(tc.id === target){
                tc.classList.add('active');
                tc.style.display = 'block';
            } else {
                tc.classList.remove('active');
                tc.style.display = 'none';
            }
        });
    });
});

/* 1RM ê³„ì‚° (í˜ì´ë“œ ì œê±° ì™„ì „ ìˆ˜ì •ë³¸) */
goBtn.addEventListener('click', ()=>{
    const weight = parseFloat(weightSelect.value);
    const reps = parseInt(repsSelect.value);

    if(!weight || !reps){
        resultDiv.innerHTML = "ë¬´ê²Œì™€ ë°˜ë³µìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.";
        return;
    }

    const oneRM = weight * (1 + reps * 0.0333);

    // ê³„ì‚° ê²°ê³¼ ì¶œë ¥ (ì‚¬ë¼ì§€ì§€ ì•ŠìŒ)
    resultDiv.innerHTML = `ì˜ˆìƒ 1RM: <b>${oneRM.toFixed(1)} kg</b>`;

    // í‘œ ìƒì„±
    let html = `<table><tr><th>RM</th><th>ë¬´ê²Œ (kg)</th></tr>`;
    for (let r=1; r<=10; r++){
        let rmWeight = oneRM / (1 + (r-1)*0.0333);
        html += `<tr><td>${r}RM</td><td>${rmWeight.toFixed(1)} kg</td></tr>`;
    }
    html += `</table>`;

    tableArea.innerHTML = html;
});


/* í˜ì´ë“œ í…ìŠ¤íŠ¸ ìœ í‹¸ */
function fadeOutElem(el, timeout=1000, fadeDur=800){
    el.style.opacity = 1;
    setTimeout(()=>{
        el.style.transition = `opacity ${fadeDur}ms ease`;
        el.style.opacity = 0;
        setTimeout(()=>{ el.innerHTML=''; el.style.opacity=1; el.style.transition=''; }, fadeDur);
    }, timeout);
}
function fadeTempMsg(el, msg, timeout=1000, fadeDur=800){
    el.innerHTML = msg;
    el.style.opacity = 1; 
    setTimeout(()=>{
        el.style.transition = `opacity ${fadeDur}ms ease`;
        el.style.opacity = 0;
        setTimeout(()=>{ el.innerHTML=''; el.style.opacity=1; el.style.transition=''; }, fadeDur);
    }, timeout);
}

/* 3ëŒ€ ì´í•© ì—…ë°ì´íŠ¸ */
function updateTotal3(){
    const b = parseInt(benchRM.value)||0;
    const s = parseInt(squatRM.value)||0;
    const d = parseInt(deadRM.value)||0;
    total3.textContent = `3ëŒ€: ${b+s+d} kg`;
}
[benchRM, squatRM, deadRM].forEach(el => el.addEventListener('input', updateTotal3));



/* save3Btn: ì „ì²´(3ëŒ€) ì €ì¥ â€” í•­ìƒ ë³´ì´ì§€ë§Œ FirestoreëŠ” ë¡œê·¸ì¸ ìˆì„ ë•Œë§Œ ì €ì¥ */
save3Btn.addEventListener('click', async ()=>{

    const user = auth.currentUser;

    if(!user){
        showSave3Message('ë¡œê·¸ì¸ í›„ ì €ì¥í•´ì£¼ì„¸ìš”');
        return;
    }

    const bench = parseInt(benchRM.value)||0;
    const squat = parseInt(squatRM.value)||0;
    const dead = parseInt(deadRM.value)||0;
    const total = bench + squat + dead;

    if(total === 0){
        showSave3Message('ê°’ì„ ì…ë ¥í•˜ì„¸ìš”');
        return;
    }

    try{
        await db
          .collection('users')
          .doc(user.uid)
          .collection('threeRM') // ğŸ”¥ ìˆ«ì ì œê±°
          .add({
              bench,
              squat,
              dead,
              total,
              createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });

        showSave3Message('3ëŒ€ ê¸°ë¡ ì €ì¥ ì™„ë£Œ!');
    }catch(e){
        console.error('3ëŒ€ ì €ì¥ ì—ëŸ¬:', e);
        showSave3Message('ì €ì¥ ì‹¤íŒ¨ (ì½˜ì†” í™•ì¸)');
    }
});

/* í´ë” ë²„íŠ¼ ë™ì‘ (ê°€ë¡œ ë²„íŠ¼ â†’ í•˜ë‚˜ì˜ ë°•ìŠ¤ë§Œ active) */
folderBtns.forEach(btn=>{
    btn.addEventListener('click', ()=>{
        folderBtns.forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const target = btn.dataset.target;
        folderContents.forEach(fc=>{
            if(fc.id === target) fc.classList.add('active');
            else fc.classList.remove('active');
        });
       renderActiveBox();
    });
});

/* ê¸°ë¡ ë°•ìŠ¤ ë°ì´í„° (ë¡œì»¬ mock) ë° ë Œë” í•¨ìˆ˜ */
const records = { bench: [], squat: [], dead: [] };

// í¬ë§· ë‚ ì§œ: '25.12.10'
function formatTodayYYMMDD(d = new Date()){
    const yy = String(d.getFullYear()).slice(2);
    const mm = String(d.getMonth()+1).padStart(2,'0');
    const dd = String(d.getDate()).padStart(2,'0');
    return `${yy}.${mm}.${dd}`;
}

// ì´ˆê¸° ë‚ ì§œ í‘œì‹œ
recordDate.value = formatTodayYYMMDD();

// ë Œë” í•¨ìˆ˜: í˜„ì¬ active folderì˜ ëª©ë¡ì„ ê·¸ë ¤ì¤Œ
function renderActiveBox(){
    const activeBtn = document.querySelector('.folderBtn.active');
    const target = activeBtn ? activeBtn.dataset.target : 'benchBox';
    let arr = [];
    if(target === 'benchBox') arr = records.bench;
    else if(target === 'squatBox') arr = records.squat;
    else if(target === 'deadBox') arr = records.dead;

    const boxEl = document.getElementById(target);
if(!arr || arr.length === 0){
    boxEl.innerHTML = `<div style="color:#777;font-size:13px;">ê¸°ë¡ì´ ì—¬ê¸°ì— ìŒ“ì…ë‹ˆë‹¤</div>`;
    return;
}

    // ìµœì‹  ìœ„ë¡œ
boxEl.innerHTML = arr.map(it => {
  return `
    <div class="recordItem"
         data-id="${it.firestoreId}"
         style="display:flex;justify-content:space-between;
                padding:6px 0;
                border-bottom:1px solid rgba(255,255,255,0.06)">
      <div style="color:#ddd">${it.date}</div>
      <div>${it.weight}kg Ã— ${it.reps}íšŒ</div>
    </div>
  `;
}).join('');
}
renderActiveBox();

/* ê¸°ë¡ ì¶”ê°€ (ê°€ë¡œ í¼ì—ì„œ ì €ì¥) */
recordAdd.addEventListener('click', async ()=>{
    const weight = parseInt(recordWeight.value);
    const reps = parseInt(recordReps.value);

    if(!weight || !reps){
        fadeTempMsg(recordMessage, 'ë¬´ê²Œì™€ íšŸìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”', 900, 600);
        return;
    }

    const date = formatTodayYYMMDD();

    const activeBtn = document.querySelector('.folderBtn.active');
    const target = activeBtn ? activeBtn.dataset.target : 'benchBox';

    const lift =
      target === 'benchBox' ? 'bench' :
      target === 'squatBox' ? 'squat' :
      'dead';

    const item = {
        firestoreId: null,
        date,
        weight,
        reps
    };

    if(lift === 'bench') records.bench.unshift(item);
    if(lift === 'squat') records.squat.unshift(item);
    if(lift === 'dead')  records.dead.unshift(item);

    recordWeight.value = '';
    recordReps.value = '';
    fadeTempMsg(recordMessage, 'ê¸°ë¡ ì¶”ê°€ ì™„ë£Œ', 700, 600);
    renderActiveBox();

    const user = auth.currentUser;
    if(user){
        try{
            const docRef = await db
              .collection('users')
              .doc(user.uid)
              .collection('records')
              .add({
                lift,
                date,
                weight,
                reps,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
              });

            item.firestoreId = docRef.id;
        }catch(e){
            console.error('Firestore add err', e);
        }
    }
});


/* ë¡œê·¸ì¸ (êµ¬ê¸€) */
googleLoginBtn.addEventListener('click', ()=>{
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider).catch(e=>alert('ë¡œê·¸ì¸ ì‹¤íŒ¨: '+e.message));
});
logoutBtn.addEventListener('click', ()=> auth.signOut());

/* auth ìƒíƒœ ë³€í™” */
auth.onAuthStateChanged(async user=>{
    if(user){
        googleLoginBtn.style.display = 'none';
        logoutBtn.style.display = 'block';
        userInfo.textContent = user.displayName || user.email || '';

        /* ğŸ”¥ [ì¶”ê°€] 3ëŒ€ ê¸°ë¡ ìµœì‹ ê°’ ë¶ˆëŸ¬ì˜¤ê¸° */
        try{
            const threeSnap = await db
              .collection('users')
              .doc(user.uid)
              .collection('threeRM')
              .orderBy('createdAt', 'desc')
              .limit(1)
              .get();

            if(!threeSnap.empty){
                const data = threeSnap.docs[0].data();
                benchRM.value = data.bench || 0;
                squatRM.value = data.squat || 0;
                deadRM.value = data.dead || 0;
                updateTotal3(); // ì´í•© ê°±ì‹ 
            }
        }catch(e){
            console.error('load threeRM err', e);
        }

        /* ê¸°ì¡´ records ë¡œë“œ (ê·¸ëŒ€ë¡œ ìœ ì§€) */
        try{
            const snap = await db
              .collection('users')
              .doc(user.uid)
              .collection('records')
              .orderBy('createdAt','desc')
              .limit(200)
              .get();

            records.bench = [];
            records.squat = [];
            records.dead = [];

            snap.forEach(doc=>{
                const d = doc.data();
                if(!d || !d.lift) return;

               const item = {
  firestoreId: doc.id,
  date: d.date,
  weight: d.weight,
  reps: d.reps
};

                if(d.lift === 'bench') records.bench.push(item);
                if(d.lift === 'squat') records.squat.push(item);
                if(d.lift === 'dead') records.dead.push(item);
            });

            renderActiveBox();

        }catch(e){
            console.error('load records err', e);
        }

    } else {
        googleLoginBtn.style.display = 'block';
        logoutBtn.style.display = 'none';
        userInfo.textContent = '';
    }
});



 

/* ë©”ì‹œì§€ í˜ì´ë“œì•„ì›ƒ */
function showSave3Message(msg) {
    save3Result.textContent = msg;
    save3Result.style.opacity = 1;

    setTimeout(() => {
        save3Result.style.transition = "opacity 0.8s";
        save3Result.style.opacity = 0;

        setTimeout(() => {
            save3Result.textContent = "";
            save3Result.style.transition = "";
            save3Result.style.opacity = 1;
        }, 800);
    }, 1000);
}
   
function setTodayDisplay() {
    const now = new Date();
    const year = now.getFullYear();
    const mm = String(now.getMonth() + 1).padStart(2, '0');
    const dd = String(now.getDate()).padStart(2, '0');

    document.getElementById("displayYear").textContent = `${year}`;
    document.getElementById("displayMD").textContent = `${mm}.${dd}`;
}

setTodayDisplay();

/******** ë‹¬ë ¥ + long press ì½”ë“œ ì—¬ê¸° ********/
/********************
 * ğŸ“… ë‹¬ë ¥ ë¡œì§ (tab3)
 ********************/

const calDaysEl = document.getElementById("calDays");
const calMonthEl = document.getElementById("calMonth");
const calPopup = document.getElementById("calPopup");
const calPopupDate = document.getElementById("calPopupDate");
const calSaveBtn = document.getElementById("calSave");
const calMuscleBtns = calPopup.querySelectorAll(".muscles button");

let calCurrent = new Date();
let calData = JSON.parse(localStorage.getItem("workoutCalendar")) || {};
let calSelectedDate = null;
let calSelectedMuscles = [];

function calRender() {
   
   
  calDaysEl.innerHTML = "";

  const y = calCurrent.getFullYear();
  const m = calCurrent.getMonth();
 calMonthEl.textContent = `${y}ë…„ ${m + 1}ì›”`;


  const first = new Date(y, m, 1);
  const start = (first.getDay() + 6) % 7;
  const last = new Date(y, m + 1, 0).getDate();

  for (let i = 0; i < start; i++) {
    calDaysEl.appendChild(document.createElement("div"));
  }

  for (let d = 1; d <= last; d++) {
    const cell = document.createElement("div");
    const key = `${y}-${m + 1}-${d}`;
    cell.textContent = d;

const today = new Date();
const isToday =
  d === today.getDate() &&
  m === today.getMonth() &&
  y === today.getFullYear();

if (isToday) {
  cell.classList.add("today");
}


     
    if (calData[key]?.muscles?.length) {
      cell.classList.add("done");

       
    }

    let timer;
    cell.addEventListener("touchstart", () => {
      timer = setTimeout(() => calOpenPopup(key), 500);
    });
    cell.addEventListener("touchend", () => clearTimeout(timer));

    cell.addEventListener("mousedown", () => {
      timer = setTimeout(() => calOpenPopup(key), 500);
    });
    cell.addEventListener("mouseup", () => clearTimeout(timer));

    calDaysEl.appendChild(cell);
  }
}

function calOpenPopup(key) {
  calSelectedDate = key;
  calSelectedMuscles = calData[key]?.muscles || [];
  calPopupDate.textContent = key;

  calMuscleBtns.forEach(btn => {
    btn.classList.toggle(
      "active",
      calSelectedMuscles.includes(btn.dataset.muscle)
    );
  });

  calPopup.classList.remove("hidden");
}

calMuscleBtns.forEach(btn => {
  btn.onclick = () => {
    const m = btn.dataset.muscle;
    if (calSelectedMuscles.includes(m)) {
      calSelectedMuscles = calSelectedMuscles.filter(x => x !== m);
    } else {
      calSelectedMuscles.push(m);
    }
    btn.classList.toggle("active");
  };
});

calSaveBtn.onclick = () => {
  if (calSelectedMuscles.length === 0) {
    delete calData[calSelectedDate];
  } else {
    calData[calSelectedDate] = { muscles: calSelectedMuscles };
  }
  localStorage.setItem("workoutCalendar", JSON.stringify(calData));
  calRender();
};

calPopup.onclick = e => {
  if (e.target === calPopup) calPopup.classList.add("hidden");
};

document.getElementById("calPrev").onclick = () => {
  calCurrent.setMonth(calCurrent.getMonth() - 1);
  calRender();
};

document.getElementById("calNext").onclick = () => {
  calCurrent.setMonth(calCurrent.getMonth() + 1);
  calRender();
};

calRender();

let pressTimer = null;

document.addEventListener("mousedown", e => {
    const item = e.target.closest(".recordItem");
    if (!item) return;

    pressTimer = setTimeout(() => {
        deleteRecord(item.dataset.id);
    }, 600);
});

document.addEventListener("mouseup", () => {
    clearTimeout(pressTimer);
});

document.addEventListener("touchstart", e => {
    const item = e.target.closest(".recordItem");
    if (!item) return;

    pressTimer = setTimeout(() => {
        deleteRecord(item.dataset.id);
    }, 600);
});

document.addEventListener("touchend", () => {
    clearTimeout(pressTimer);
});
document.addEventListener("touchmove", () => {
    clearTimeout(pressTimer);
});
   
  async function deleteRecord(firestoreId){
    if(!confirm("ì´ ê¸°ë¡ì„ ì‚­ì œí• ê¹Œìš”?")) return;

    // ğŸ”¥ ë¡œì»¬ ì‚­ì œ
    ["bench","squat","dead"].forEach(type=>{
        records[type] = records[type].filter(r => r.firestoreId !== firestoreId);
    });

    renderActiveBox();

    // ğŸ”¥ Firestore ì‚­ì œ (ë¬¸ì„œ IDë¡œ)
    const user = auth.currentUser;
    if(user && firestoreId){
        await db.collection('users')
          .doc(user.uid)
          .collection('records')
          .doc(firestoreId)
          .delete();
    }
}

</script>
<!-- âš ï¸ ì—¬ê¸° ì•„ë˜ì— ë„¤ê°€ ì“°ë˜ JS ê·¸ëŒ€ë¡œ ìœ ì§€ -->
</body>
</html>
